# 2.5 编程软件的使用

> 本节将介绍常用PLC编程软件的基本操作

## 学习目标

- 了解主流PLC编程软件
- 掌握编程软件的基本操作
- 能够完成程序的编写、下载和调试

---

## 1. 西门子TIA Portal介绍

### 1.1 软件概述

**TIA Portal**（Totally Integrated Automation Portal，全集成自动化门户）是西门子最新一代的工程软件平台。

```
TIA Portal软件架构：

┌─────────────────────────────────────────────────────┐
│                   TIA Portal                        │
│  ┌─────────────────────────────────────────────┐   │
│  │                 统一界面                     │   │
│  └─────────────────────────────────────────────┘   │
│     │           │           │           │          │
│     ▼           ▼           ▼           ▼          │
│  ┌──────┐   ┌──────┐   ┌──────┐   ┌──────┐       │
│  │STEP 7│   │WinCC │   │STARTⅡ│   │Safety│       │
│  │ PLC  │   │ HMI  │   │ 驱动 │   │ 安全 │       │
│  └──────┘   └──────┘   └──────┘   └──────┘       │
│                                                     │
│  支持：S7-1200, S7-1500, S7-300/400              │
└─────────────────────────────────────────────────────┘
```

### 1.2 主要特点

| 特点 | 说明 |
|------|------|
| **集成化** | PLC、HMI、驱动器在一个平台 |
| **智能化** | 自动检测硬件、智能提示 |
| **仿真功能** | 内置PLCSIM仿真器 |
| **符号编程** | 推荐使用符号地址 |
| **多语言** | 支持5种IEC编程语言 |

### 1.3 界面介绍

```
TIA Portal主界面：

┌─────────────────────────────────────────────────────────────┐
│  菜单栏 | 工具栏                                            │
├───────────────┬─────────────────────────────┬───────────────┤
│               │                             │               │
│  项目树       │      程序编辑区              │   任务卡      │
│               │                             │               │
│  · 项目       │  ┌─────────────────────┐   │  · 指令       │
│    · PLC_1    │  │                     │   │  · 测试       │
│      · 程序块 │  │   梯形图/FBD/ST     │   │  · 诊断       │
│        · Main │  │   程序编写区域      │   │               │
│      · 变量表 │  │                     │   │               │
│      · 设备   │  └─────────────────────┘   │               │
│               │                             │               │
├───────────────┴─────────────────────────────┴───────────────┤
│  详细视图 / 属性 / 信息 / 诊断                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 2. 三菱GX Works介绍

### 2.1 软件版本

```
三菱编程软件演进：

GX Developer ──▶ GX Works2 ──▶ GX Works3
   (停产)         (主流)        (最新)
                    │              │
                    ▼              ▼
               FX3U/3G/Q系列   FX5U/iQ-R系列
```

### 2.2 GX Works2界面

```
GX Works2主界面：

┌─────────────────────────────────────────────────────────────┐
│  文件 | 编辑 | 查找 | 编译 | 在线 | 诊断 | 工具 | 窗口      │
├───────────────┬─────────────────────────────────────────────┤
│               │                                             │
│  导航窗口     │            编辑窗口                         │
│               │                                             │
│  ▼ 工程      │  ┌─────────────────────────────────────┐   │
│    ▼ 参数    │  │         梯形图程序                   │   │
│    ▼ POU     │  │                                     │   │
│      · MAIN  │  │    X0        Y0                     │   │
│    ▼ 全局标签│  │  ──┤├──────( )──                    │   │
│    ▼ 设备注释│  │                                     │   │
│               │  │    X1   X2                         │   │
│               │  │  ──┤├──┤├──( Y1 )──               │   │
│               │  │                                     │   │
│               │  └─────────────────────────────────────┘   │
├───────────────┴─────────────────────────────────────────────┤
│  输出窗口 | 查找结果 | 设备监视                             │
└─────────────────────────────────────────────────────────────┘
```

### 2.3 GX Works特点

| 特点 | 说明 |
|------|------|
| **简单易学** | 界面直观，入门容易 |
| **指令丰富** | 内置大量应用指令 |
| **仿真功能** | 配合GX Simulator使用 |
| **梯形图为主** | 梯形图编程最常用 |

---

## 3. 项目创建与配置

### 3.1 TIA Portal项目创建

```
创建新项目步骤（TIA Portal）：

1. 启动TIA Portal
   └── 选择"创建新项目"

2. 输入项目信息
   ├── 项目名称：MyFirstProject
   ├── 路径：C:\TIA_Projects
   └── 作者：Your Name

3. 添加新设备
   ├── 选择CPU型号（如S7-1200 CPU 1214C）
   ├── 选择固件版本
   └── 点击"添加"

4. 硬件配置
   ├── 配置CPU参数
   ├── 添加扩展模块（如需要）
   └── 配置通信接口

5. 创建程序块
   ├── 组织块OB1（主程序）
   └── 功能块FB/函数FC（根据需要）
```

### 3.2 GX Works2项目创建

```
创建新项目步骤（GX Works2）：

1. 启动GX Works2
   └── 工程 → 新建

2. 选择PLC系列
   ├── 系列：FXCPU
   ├── 机型：FX3U/FX3G
   └── 点击确定

3. 设置工程参数
   ├── 工程名称
   ├── 保存路径
   └── 程序语言（梯形图/ST等）

4. 开始编程
   └── 在程序编辑窗口编写梯形图
```

### 3.3 硬件配置要点

```
硬件配置核心内容：

┌────────────────────────────────────────────────────┐
│  1. CPU配置                                        │
│     · 启动特性（暖启动/冷启动）                   │
│     · 循环时间监视                                │
│     · 时钟存储器地址                              │
├────────────────────────────────────────────────────┤
│  2. 通信配置                                       │
│     · IP地址设置                                  │
│     · 通信端口参数                                │
│     · 通信协议选择                                │
├────────────────────────────────────────────────────┤
│  3. I/O配置                                        │
│     · 输入滤波时间                                │
│     · 输出响应时间                                │
│     · 模块参数设置                                │
└────────────────────────────────────────────────────┘
```

---

## 4. 程序编写与编译

### 4.1 梯形图编程步骤

```
梯形图编写步骤：

1. 规划程序结构
   └── 确定输入/输出、中间变量

2. 定义变量（符号表）
   ├── 输入：启动按钮 → I0.0
   ├── 输出：电机运行 → Q0.0
   └── 中间：运行标志 → M0.0

3. 绘制梯形图
   ├── 选择触点（常开/常闭）
   ├── 连接线路
   └── 添加输出线圈

4. 添加注释
   ├── 网络注释（说明功能）
   └── 元件注释（说明用途）

5. 编译检查
   └── 检查语法错误
```

### 4.2 TIA Portal编程操作

```
TIA Portal梯形图编程：

【插入触点】
· 从指令栏拖拽到程序区
· 或使用快捷键F2（常开）、F3（常闭）

【插入线圈】
· 从指令栏拖拽
· 或使用快捷键F7

【连接元件】
· 点击元件端子拖动连线
· 自动对齐功能

【编译程序】
· 点击编译按钮（或Ctrl+B）
· 查看编译结果

【常用快捷键】
F2  - 常开触点      F7  - 输出线圈
F3  - 常闭触点      F8  - 分支
F4  - 取反          F9  - 空行
F5  - 触点(S)       Ctrl+B - 编译
F6  - 触点(R)       Ctrl+S - 保存
```

### 4.3 GX Works2编程操作

```
GX Works2梯形图编程：

【快捷键】
F5  - 常开触点(LD)    Shift+F5 - 并联常开(OR)
F6  - 常闭触点(LDI)   Shift+F6 - 并联常闭(ORI)
F7  - 输出(OUT)       F8 - 应用指令
F9  - 纵线连接        F10 - 横线连接

【编程示例】
输入：F5 → 输入 X0 → Enter
      F6 → 输入 X1 → Enter  
输出：F7 → 输入 Y0 → Enter

【编译转换】
· 编译 → 转换（F4）
· 查看错误信息

【注释】
· 设备注释：给X、Y、M等添加名称
· 语句注释：说明每行程序的功能
```

---

## 5. 程序下载与上传

### 5.1 通信连接

```
PLC通信连接方式：

┌────────────────────────────────────────────────────┐
│  连接方式          说明              速度          │
├────────────────────────────────────────────────────┤
│  USB              直接USB连接        快速          │
│  以太网           网线/交换机        最快          │
│  MPI/PROFIBUS     西门子专用         中等          │
│  串口(RS232/422)  传统方式           较慢          │
└────────────────────────────────────────────────────┘

【连接步骤】
1. 物理连接（网线/USB线）
2. 配置通信参数
3. 搜索/添加设备
4. 建立在线连接
```

### 5.2 程序下载

```
程序下载步骤：

【TIA Portal下载】
1. 点击"下载到设备"按钮
2. 选择目标PLC
3. 选择下载内容
   ├── 硬件配置
   ├── 软件（程序）
   └── 全部
4. 确认下载
5. 选择是否启动CPU

【GX Works2下载】
1. 在线 → 写入PLC
2. 选择写入内容
   ├── 参数+程序
   └── 仅程序
3. 确认执行
4. 完成后自动运行

【注意事项】
⚠️ 下载前确认PLC状态（STOP/RUN）
⚠️ 生产环境下载需谨慎
⚠️ 建议先备份原程序
```

### 5.3 程序上传

```
程序上传（从PLC读取）：

【用途】
· 备份现场程序
· 恢复丢失的源程序
· 对比程序差异

【TIA Portal上传】
1. 在线 → 从设备上传
2. 选择上传范围
3. 保存到项目

【GX Works2上传】
1. 在线 → 从PLC读取
2. 选择读取内容
3. 保存工程

【注意】
⚠️ 上传的程序可能没有注释
⚠️ 符号名称可能丢失
⚠️ 建议平时做好程序管理
```

---

## 6. 在线监控与调试

### 6.1 在线监控

```
在线监控功能：

┌─────────────────────────────────────────────────────┐
│                在线监控界面                          │
├─────────────────────────────────────────────────────┤
│                                                     │
│    I0.0         I0.1                               │
│  ══┥┝══════╦════┥/┝══════════════════( Q0.0 )═══   │
│    ON      ║    OFF                     ON         │
│            ║                                        │
│    Q0.0    ║                                        │
│  ──┥┝──────╝                                        │
│    ON                                               │
│                                                     │
│  导通路径显示为粗线/绿色                           │
│  断开路径显示为细线/灰色                           │
│  实时显示变量值                                    │
└─────────────────────────────────────────────────────┘
```

### 6.2 变量监视表

```
变量监视表使用：

【功能】
· 实时查看变量值
· 修改变量值
· 强制变量状态

【创建监视表】
1. 新建监视表
2. 添加要监视的变量
   ├── I0.0 - 启动按钮
   ├── Q0.0 - 电机输出
   ├── MW100 - 计数值
   └── DB1.Speed - 速度
3. 启动监视

【变量修改】
1. 选择要修改的变量
2. 输入新值
3. 确认修改

【强制功能】
1. 选择要强制的I/O
2. 强制为指定值
3. 用于调试（慎用！）
```

### 6.3 调试技巧

```
程序调试技巧：

┌────────────────────────────────────────────────────┐
│  1. 分段调试                                       │
│     · 先调试输入采集                              │
│     · 再调试逻辑运算                              │
│     · 最后调试输出控制                            │
├────────────────────────────────────────────────────┤
│  2. 使用中间变量                                   │
│     · 将复杂逻辑分解到M区                         │
│     · 便于观察中间结果                            │
├────────────────────────────────────────────────────┤
│  3. 善用注释                                       │
│     · 标注每段程序的功能                          │
│     · 记录修改历史                                │
├────────────────────────────────────────────────────┤
│  4. 仿真测试                                       │
│     · 先在仿真器中测试                            │
│     · 减少现场调试时间                            │
├────────────────────────────────────────────────────┤
│  5. 备份习惯                                       │
│     · 每次修改前备份                              │
│     · 使用版本号管理                              │
└────────────────────────────────────────────────────┘
```

---

## 7. 仿真功能

### 7.1 西门子PLCSIM

```
PLCSIM仿真器：

【功能】
· 在PC上模拟PLC运行
· 无需实际硬件即可测试
· 支持完整的程序调试

【使用步骤】
1. 在TIA Portal中点击"启动仿真"
2. 自动启动PLCSIM
3. 下载程序到仿真PLC
4. 设置输入信号
5. 观察程序执行结果

【仿真界面】
┌─────────────────────────────┐
│  PLCSIM S7-1200            │
├─────────────────────────────┤
│  CPU状态：RUN               │
│  ┌───────────────────────┐ │
│  │ I0.0 [  ] I0.4 [  ]  │ │
│  │ I0.1 [  ] I0.5 [  ]  │ │
│  │ I0.2 [  ] I0.6 [  ]  │ │
│  │ I0.3 [  ] I0.7 [  ]  │ │
│  └───────────────────────┘ │
│  点击方框可切换输入状态     │
└─────────────────────────────┘
```

### 7.2 三菱GX Simulator

```
GX Simulator仿真：

【启动方式】
1. 在GX Works2中
2. 调试 → 模拟启动
3. 或快捷键（根据版本）

【仿真操作】
· 手动操作输入信号
· 观察输出变化
· 监视定时器/计数器
· 测试程序逻辑
```

---

## 8. 常见问题与解决

### 8.1 通信问题

| 问题 | 可能原因 | 解决方法 |
|------|----------|----------|
| 找不到PLC | 网络不通 | 检查网线、IP设置 |
| 连接超时 | IP冲突 | 修改IP地址 |
| 下载失败 | PLC在运行 | 切换到STOP模式 |
| 权限不足 | 密码保护 | 输入正确密码 |

### 8.2 编译错误

```
常见编译错误及解决：

【地址重复】
错误：Address already in use
解决：检查是否有重复的输出地址

【类型不匹配】
错误：Data type mismatch
解决：确保变量类型与指令要求一致

【未定义变量】
错误：Undefined variable
解决：在变量表中定义该变量

【语法错误】
错误：Syntax error
解决：检查指令格式是否正确
```

---

## 本节小结

```
编程软件使用要点：

┌────────────────────────────────────────────────────┐
│  主流编程软件                                      │
│  ─────────────                                     │
│  · 西门子：TIA Portal（S7-1200/1500）             │
│  · 三菱：GX Works2/3（FX系列）                    │
├────────────────────────────────────────────────────┤
│  基本操作流程                                      │
│  ─────────────                                     │
│  1. 创建项目 → 2. 硬件配置 → 3. 编写程序          │
│  4. 编译检查 → 5. 下载程序 → 6. 在线调试          │
├────────────────────────────────────────────────────┤
│  调试技巧                                          │
│  ─────────                                         │
│  · 善用仿真功能，减少现场调试                     │
│  · 使用监视表实时观察变量                         │
│  · 分段调试，从简单到复杂                         │
│  · 养成备份习惯                                   │
└────────────────────────────────────────────────────┘
```

---

## 练习题

1. 描述TIA Portal创建新项目的步骤。
2. 说明程序下载前需要注意哪些事项。
3. 如何使用仿真功能测试程序？
4. 列举三种常见的编译错误及其解决方法。

---

[← 上一节：2.4 数据类型与寻址方式](./2.4_数据类型与寻址方式.md) | [返回目录](../README.md) | [下一章：第三章 基本指令应用 →](../第三章_基本指令应用/3.1_位逻辑指令.md)
