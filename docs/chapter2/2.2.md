# 2.2 梯形图编程入门

> 本节将介绍梯形图编程的基础知识

## 学习目标

- 理解梯形图的基本概念
- 掌握梯形图的基本元素
- 能够绘制简单的梯形图程序

---

## 1. 梯形图的起源与特点

### 1.1 起源

梯形图（Ladder Diagram，LD）起源于**继电器控制电路图**。为了让电气工程师能够快速上手PLC编程，设计者将传统的继电器电路图"横过来"，形成了类似梯子的图形——梯形图。

```
继电器电路图 → 梯形图的演变：

【传统继电器电路图】           【PLC梯形图】

    L ─────┬─────── N              │                │
           │                       ├──┤├──┬──────( )─┤
         ┌─┴─┐                     │ SB1 │     KA1  │
         │SB1│                     │     │          │
         └─┬─┘                     │ KA1 │          │
           │                       ├─┤├──┘          │
         ┌─┴─┐                     │                │
         │KA1│                     
         └───┘                     

  纵向表示                         横向表示
  电源在上下                       电源在左右（母线）
```

### 1.2 为什么叫梯形图？

```
梯形图得名原因：

左母线                                   右母线
(L)                                      (N)
  │                                        │
  ├───┤├───┬───┤/├───────────────( )───┤  ← 横档1
  │        │                               │
  │        │                               │
  ├───┤├───┘                               │  ← 横档2
  │                                        │
  │                                        │
  ├───┤├───────────────────────────(S)───┤  ← 横档3
  │                                        │
  │                                        │
  ├───┤├───────────────────────────(R)───┤  ← 横档4
  │                                        │

整体形状像一个"梯子"，所以称为梯形图
```

### 1.3 特点总结

| 特点 | 说明 |
|------|------|
| **直观性** | 类似电气原理图，电气人员容易理解 |
| **通用性** | 所有PLC品牌都支持，是最通用的编程语言 |
| **调试性** | 在线监控时，导通路径高亮显示，便于调试 |
| **适用性** | 特别适合开关量逻辑控制 |

---

## 2. 梯形图的基本结构

### 2.1 整体结构

```
梯形图结构组成：

  ┌─────────────────────────────────────────────────┐
  │                                                 │
  │  左母线        控制逻辑         输出    右母线  │
  │    │      ┌───────────────┐              │     │
  │    │      │               │              │     │
  │    ├──────┤  触点组合     ├──────────────┤     │
  │    │      │  (输入条件)   │   线圈       │     │
  │    │      │               │  (输出结果)  │     │
  │    │      └───────────────┘              │     │
  │    │                                     │     │
  │                                                 │
  └─────────────────────────────────────────────────┘
  
  母线：代表电源
  触点：代表输入条件（按钮、传感器等）
  线圈：代表输出结果（电机、指示灯等）
```

### 2.2 程序组织

```
梯形图程序组织：

┌─────────────────────────────────────────────────────┐
│  网络1 (Network 1)                                  │
├─────────────────────────────────────────────────────┤
│      I0.0        I0.1                               │
│  ────┤├────┬────┤/├────────────────────( Q0.0 )──  │
│            │                                        │
│      Q0.0  │                                        │
│  ────┤├────┘                                        │
├─────────────────────────────────────────────────────┤
│  网络2 (Network 2)                                  │
├─────────────────────────────────────────────────────┤
│      I0.2                                           │
│  ────┤├────────────────────────────────( Q0.1 )──  │
├─────────────────────────────────────────────────────┤
│  网络3 (Network 3)                                  │
├─────────────────────────────────────────────────────┤
│      I0.3        I0.4                               │
│  ────┤├──────────┤├────────────────────( Q0.2 )──  │
└─────────────────────────────────────────────────────┘

说明：
- 每个网络(Network)是一个独立的控制逻辑单元
- 网络从上到下、从左到右执行
- 建议每个网络只有一个输出
```

---

## 3. 常开触点与常闭触点

### 3.1 常开触点（NO - Normally Open）

```
常开触点符号：

    ──┤├──    或    ──| |──
      
含义：
- 平时（无信号时）：断开状态
- 有信号时：闭合导通

物理对应：
- 常开按钮（按下才导通）
- 常开传感器（检测到物体才导通）

示例：
    I0.0                 
──────┤├──────────────( Q0.0 )──
    
当I0.0=1时，Q0.0=1（导通）
当I0.0=0时，Q0.0=0（断开）
```

### 3.2 常闭触点（NC - Normally Closed）

```
常闭触点符号：

    ──┤/├──    或    ──|/|──
      
含义：
- 平时（无信号时）：闭合导通
- 有信号时：断开

物理对应：
- 常闭按钮（按下才断开）
- 急停按钮（通常是常闭）

示例：
    I0.1                 
──────┤/├──────────────( Q0.0 )──
    
当I0.1=0时，Q0.0=1（导通，因为常闭平时导通）
当I0.1=1时，Q0.0=0（断开）
```

### 3.3 对比理解

```
常开与常闭触点对比：

输入信号    常开触点┤├    常闭触点┤/├
─────────────────────────────────────
   0           断开           导通
   1           导通           断开

记忆口诀：
- 常开：有信号才开（导通）
- 常闭：有信号才闭（断开）

逻辑关系：
- 常开触点：输出 = 输入
- 常闭触点：输出 = NOT(输入)
```

### 3.4 真值表

| 输入信号 | 常开触点 -\|  \|- | 常闭触点 -\|/\|- |
|----------|------------------|------------------|
| 0 (FALSE) | 0 (断开) | 1 (导通) |
| 1 (TRUE) | 1 (导通) | 0 (断开) |

---

## 4. 线圈与输出

### 4.1 普通线圈

```
普通输出线圈符号：

    ──( )──    或    ──(  )──
      
含义：
- 左侧逻辑条件满足时，线圈得电（输出ON）
- 左侧逻辑条件不满足时，线圈失电（输出OFF）

示例：
    I0.0                 
──────┤├──────────────( Q0.0 )──
    
当I0.0=1时，Q0.0输出ON
当I0.0=0时，Q0.0输出OFF

对应物理设备：继电器线圈、接触器线圈
```

### 4.2 置位线圈（SET）

```
置位线圈符号：

    ──(S)──    或    ──(SET)──
      
含义：
- 条件满足时，输出置1并保持
- 条件不满足时，输出保持不变（不会自动复位）

示例：
    I0.0                 
──────┤├──────────────(S Q0.0)──
    
I0.0产生上升沿时，Q0.0=1，并一直保持
即使I0.0变回0，Q0.0仍然保持1

特点：需要配合复位线圈使用
```

### 4.3 复位线圈（RESET）

```
复位线圈符号：

    ──(R)──    或    ──(RESET)──
      
含义：
- 条件满足时，输出置0
- 条件不满足时，输出保持不变

示例：
    I0.1                 
──────┤├──────────────(R Q0.0)──
    
I0.1=1时，Q0.0被复位为0

置位/复位配合使用：
    I0.0                 
──────┤├──────────────(S Q0.0)──    启动

    I0.1                 
──────┤├──────────────(R Q0.0)──    停止
```

### 4.4 各类线圈汇总

| 线圈类型 | 符号 | 功能 |
|----------|------|------|
| 普通线圈 | ( ) | 条件满足=ON，不满足=OFF |
| 置位线圈 | (S) | 条件满足时置1，保持 |
| 复位线圈 | (R) | 条件满足时置0 |
| 取反线圈 | (/) | 输出与条件相反 |
| 正跳变线圈 | (P) | 上升沿输出一个扫描周期 |
| 负跳变线圈 | (N) | 下降沿输出一个扫描周期 |

---

## 5. 梯形图的阅读方法

### 5.1 阅读顺序

```
梯形图阅读顺序：

      ①     ②       ③      ④      ⑤
      │     │        │      │      │
      ▼     ▼        ▼      ▼      ▼
  ────┤├────┬────┤/├────┬────────( )──
            │              │
      ⑥     │              │
      ▼     │              │
  ────┤├────┘              │
                           │
      ⑦     ⑧              │
      ▼     ▼              │
  ────┤├────┤├─────────────┘

执行顺序：① → ② → ③ → ④ → ⑤
         ↓
         ⑥ → 跳回主线
         ↓
         ⑦ → ⑧ → 汇合到输出

原则：从上到下，从左到右
```

### 5.2 逻辑分析方法

```
分析梯形图的步骤：

1. 找出输出
   └── 确定线圈/输出是什么（Q0.0、M0.0等）

2. 追溯输入条件
   └── 从输出向左，找出所有导通路径

3. 确定逻辑关系
   └── 串联 = AND（与）
   └── 并联 = OR（或）
   └── 常闭 = NOT（非）

4. 写出逻辑表达式
   └── 用布尔代数表示

示例：
    I0.0   I0.1
────┤├──┬──┤/├────────────( Q0.0 )──
        │
    I0.2│
────┤├──┘

逻辑表达式：Q0.0 = (I0.0 AND NOT I0.1) OR I0.2
         或：Q0.0 = I0.0 · /I0.1 + I0.2
```

### 5.3 在线监控

```
在线监控状态显示：

【正常状态】（I0.0=0，Q0.0=0）
    I0.0                 
────┤├──────────────────( Q0.0 )──
    细线表示断开

【导通状态】（I0.0=1，Q0.0=1）
    I0.0                 
━━━━┥┝━━━━━━━━━━━━━━━━━━( Q0.0 )━━
    粗线/绿色高亮表示导通

这是梯形图调试的重要优势！
```

---

## 6. 简单梯形图程序示例

### 6.1 示例1：简单启停控制

**控制要求**：按下启动按钮，电机运行；按下停止按钮，电机停止。

```
I/O分配：
输入：I0.0 - 启动按钮（常开）
      I0.1 - 停止按钮（常闭）
输出：Q0.0 - 电机接触器

梯形图程序：
    I0.0        I0.1
────┤├────┬────┤├────────────( Q0.0 )──
          │
    Q0.0  │
────┤├────┘

工作原理：
1. 按下I0.0（启动），I0.0=1，Q0.0得电
2. Q0.0的常开触点闭合，形成自保持
3. 松开I0.0，Q0.0仍然保持ON（自锁）
4. 按下I0.1（停止），I0.1断开，Q0.0失电
5. 自保持解除，电机停止
```

### 6.2 示例2：两地控制

**控制要求**：两个地方都可以启停电机。

```
I/O分配：
输入：I0.0 - 启动按钮1
      I0.1 - 启动按钮2
      I0.2 - 停止按钮1（常闭）
      I0.3 - 停止按钮2（常闭）
输出：Q0.0 - 电机

梯形图程序：
    I0.0        I0.2   I0.3
────┤├────┬────┤├────┤├────────( Q0.0 )──
          │
    I0.1  │
────┤├────┤
          │
    Q0.0  │
────┤├────┘

逻辑：(I0.0 OR I0.1 OR Q0.0) AND I0.2 AND I0.3 = Q0.0
```

### 6.3 示例3：顺序启动

**控制要求**：电机1启动后，电机2才能启动。

```
I/O分配：
输入：I0.0 - 电机1启动
      I0.1 - 电机2启动
      I0.2 - 停止（常闭）
输出：Q0.0 - 电机1
      Q0.1 - 电机2

梯形图程序：

网络1：电机1控制
    I0.0        I0.2
────┤├────┬────┤├────────────( Q0.0 )──
          │
    Q0.0  │
────┤├────┘

网络2：电机2控制（需要Q0.0先ON）
    I0.1   Q0.0   I0.2
────┤├────┤├────┤├────────────( Q0.1 )──
          │
    Q0.1  │
────┤├────┘

说明：电机2的启动条件包含Q0.0，确保顺序启动
```

### 6.4 示例4：互锁控制

**控制要求**：电机正转和反转不能同时进行。

```
I/O分配：
输入：I0.0 - 正转按钮
      I0.1 - 反转按钮
      I0.2 - 停止按钮（常闭）
输出：Q0.0 - 正转接触器
      Q0.1 - 反转接触器

梯形图程序：

网络1：正转控制
    I0.0   Q0.1   I0.2
────┤├────┤/├───┤├────────────( Q0.0 )──
          │
    Q0.0  │
────┤├────┘

网络2：反转控制
    I0.1   Q0.0   I0.2
────┤├────┤/├───┤├────────────( Q0.1 )──
          │
    Q0.1  │
────┤├────┘

互锁原理：
- Q0.1的常闭触点在正转回路中
- Q0.0的常闭触点在反转回路中
- 任何一个输出ON，另一个就无法ON
```

---

## 7. 梯形图编程规则

### 7.1 基本规则

```
梯形图编程规则：

┌─────────────────────────────────────────────────────┐
│ 规则1：触点在左，线圈在右                           │
│        ──┤├────( )──  ✓ 正确                       │
│        ──( )────┤├──  ✗ 错误                       │
├─────────────────────────────────────────────────────┤
│ 规则2：线圈不能直接连接左母线                       │
│        ──────────( )──  ✓ 正确（有触点）            │
│        ────( )────────  ✗ 错误（直接连）            │
├─────────────────────────────────────────────────────┤
│ 规则3：线圈不能串联                                 │
│        ──┤├──( )──  ✓                              │
│        ──┤├──( )──( )──  ✗ 错误                   │
├─────────────────────────────────────────────────────┤
│ 规则4：同一线圈不要重复使用（双线圈问题）           │
│        网络1: ──┤├──( Q0.0 )──                     │
│        网络2: ──┤├──( Q0.0 )──  ✗ 应避免           │
├─────────────────────────────────────────────────────┤
│ 规则5：尽量减少触点使用，简化逻辑                   │
└─────────────────────────────────────────────────────┘
```

### 7.2 推荐做法

| 做法 | 说明 |
|------|------|
| 每个网络一个输出 | 便于阅读和调试 |
| 添加注释 | 说明每个网络的功能 |
| 使用有意义的符号名 | 如Motor_Start而非I0.0 |
| 先画流程图 | 复杂逻辑先理清思路 |
| 分段调试 | 一段一段验证 |

---

## 本节小结

```
梯形图编程入门要点：

┌────────────────────────────────────────────────────┐
│  1. 梯形图源自继电器电路图，直观易懂              │
│                                                    │
│  2. 基本元素：母线、触点、线圈                    │
│                                                    │
│  3. 常开触点┤├：有信号才导通                      │
│     常闭触点┤/├：有信号才断开                     │
│                                                    │
│  4. 串联=AND，并联=OR，常闭=NOT                   │
│                                                    │
│  5. 阅读顺序：从上到下，从左到右                  │
│                                                    │
│  6. 自保持电路是最基本的控制模式                  │
└────────────────────────────────────────────────────┘
```

---

## 练习题

1. 画出以下逻辑的梯形图：Q0.0 = (I0.0 OR I0.1) AND I0.2
2. 分析以下梯形图的逻辑功能：
   ```
       I0.0   I0.1
   ────┤├────┤/├────┬────────( Q0.0 )──
                    │
       I0.2         │
   ────┤├───────────┘
   ```
3. 设计一个三地控制电机的梯形图程序。

---

[← 上一节：2.1 PLC编程语言概述](./2.1.md) | [下一节：2.3 基本逻辑指令 →](./2.3.md)
