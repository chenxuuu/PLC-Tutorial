# 6.5 PLC与HMI通信

> 本节将介绍PLC与人机界面的通信

## 学习目标

- 了解HMI的功能、分类和作用
- 掌握PLC与HMI的通信配置方法
- 理解变量映射和数据交换原理
- 熟悉HMI画面设计基础
- 能够配置报警和历史记录功能

---

## 一、HMI概述

### 1.1 HMI定义

HMI（Human Machine Interface）人机界面，也称为触摸屏或操作面板，是操作人员与控制系统之间的交互界面。

```
自动化系统中HMI的位置：

    ┌─────────────────────────────────────────┐
    │              管理层                      │
    │         SCADA/MES/ERP                   │
    └──────────────────┬──────────────────────┘
                       │
    ┌──────────────────┴──────────────────────┐
    │              监控层                      │
    │      ┌───────────────────┐             │
    │      │       HMI         │  ◄── 人机交互│
    │      │   人机界面        │             │
    │      └─────────┬─────────┘             │
    └────────────────┼────────────────────────┘
                     │
    ┌────────────────┴────────────────────────┐
    │              控制层                      │
    │             PLC/DCS                     │
    └──────────────────┬──────────────────────┘
                       │
    ┌──────────────────┴──────────────────────┐
    │              现场层                      │
    │        传感器/执行器/驱动器              │
    └─────────────────────────────────────────┘
```

### 1.2 HMI主要功能

| 功能类别 | 具体功能 | 说明 |
|:---------|:---------|:-----|
| 监视功能 | 状态显示 | 显示设备运行状态 |
| | 数据显示 | 实时数值、图表 |
| | 动画显示 | 动态模拟工艺流程 |
| 控制功能 | 启停操作 | 控制设备启动/停止 |
| | 参数设置 | 设定工艺参数 |
| | 切换模式 | 手动/自动切换 |
| 记录功能 | 报警记录 | 记录报警信息 |
| | 历史趋势 | 数据变化曲线 |
| | 操作日志 | 记录操作行为 |
| 管理功能 | 权限管理 | 用户分级管理 |
| | 配方管理 | 存储工艺配方 |
| | 报表打印 | 生成生产报表 |

### 1.3 HMI分类

```
按尺寸分类：
┌──────────────────────────────────────────┐
│ 小型（4-7寸）  │ 简单监控，成本低        │
│ 中型（10-12寸）│ 主流应用，功能适中      │
│ 大型（15-21寸）│ 复杂系统，功能强大      │
│ 工控机        │ PC级功能，扩展性强      │
└──────────────────────────────────────────┘

按类型分类：
┌──────────────────────────────────────────┐
│ 文本显示器    │ 简单数码显示            │
│ 图形显示器    │ 单色/彩色图形           │
│ 触摸屏       │ 触摸操作，主流选择       │
│ 平板电脑     │ 移动监控，Web访问        │
└──────────────────────────────────────────┘
```

### 1.4 主流HMI品牌

| 品牌 | 产品系列 | 编程软件 | 特点 |
|:-----|:---------|:---------|:-----|
| 西门子 | TP/KP/KTP/TP Comfort | WinCC/TIA Portal | 与S7无缝集成 |
| 三菱 | GOT2000/GOT1000 | GT Designer3 | 与三菱PLC配合好 |
| 欧姆龙 | NS/NA系列 | CX-Designer | 功能丰富 |
| 威纶通 | MT/cMT系列 | EBPro | 性价比高 |
| 昆仑通态 | TPC系列 | MCGS | 国产主流 |
| 普洛菲斯 | GP系列 | GP-Pro EX | 驱动丰富 |

---

## 二、通信连接方式

### 2.1 物理连接方式

```
HMI与PLC连接方式：

1. 串口连接（RS232/RS485）
   ┌─────┐     串口线      ┌─────┐
   │ HMI │ ═══════════════ │ PLC │
   └─────┘  RS232/485     └─────┘
   特点：简单、成本低、距离有限

2. 以太网连接
   ┌─────┐                  ┌─────┐
   │ HMI │ ──┐         ┌── │ PLC │
   └─────┘   │         │   └─────┘
             │ ┌─────┐ │
             └─┤交换机├─┘
               └─────┘
   特点：速度快、支持多连接、便于扩展

3. 总线连接（MPI/PROFIBUS）
   ┌─────┐     MPI/DP      ┌─────┐
   │ HMI │ ═══════════════ │ PLC │
   └─────┘               └─────┘
   特点：专用协议、集成度高
```

### 2.2 通信协议

| 协议类型 | 适用场景 | PLC支持 |
|:---------|:---------|:---------|
| MPI | 西门子S7-300/400 | 西门子专用 |
| PROFIBUS | 西门子系统 | 西门子专用 |
| PROFINET | 西门子以太网 | 西门子专用 |
| Modbus RTU | 串口通用 | 多品牌 |
| Modbus TCP | 以太网通用 | 多品牌 |
| MC协议 | 三菱以太网 | 三菱专用 |
| FINS | 欧姆龙 | 欧姆龙专用 |
| EtherNet/IP | AB系统 | AB专用 |

### 2.3 西门子HMI连接配置

**TIA Portal集成配置**：

```
1. 添加HMI设备
   项目视图 → 添加新设备 → HMI
   选择型号如：KTP700 Basic
   
2. 选择PLC连接
   HMI连接向导 → 选择目标PLC
   
3. 配置连接参数
   ┌────────────────────────────────┐
   │ 接口类型：PROFINET             │
   │ HMI IP：192.168.0.2           │
   │ PLC IP：192.168.0.1           │
   │ 连接名称：HMI_Connection_1     │
   └────────────────────────────────┘

4. 自动创建变量表
   HMI变量自动与PLC变量关联
```

**MPI/DP连接配置**：
```
网络视图配置：
┌─────────────────────────────────────┐
│ 网络类型：MPI/PROFIBUS             │
│ 地址分配：                          │
│   - PLC：2                         │
│   - HMI：1                         │
│ 传输速率：187.5Kbps               │
└─────────────────────────────────────┘
```

### 2.4 三菱HMI连接配置

**GT Designer3配置**：

```
1. 新建工程
   工程 → 新建工程
   选择：GOT2000系列 → GT27型号
   
2. 设置通信
   公共设置 → 控制器设置
   
3. 选择连接方式
   ┌────────────────────────────────┐
   │ 通道1：以太网                  │
   │   协议：MELSEC-Q/L             │
   │   PLC IP：192.168.0.10        │
   │   端口：5007                   │
   │                                │
   │ 通道2：串口（可选）            │
   │   协议：MELSEC-FX             │
   │   端口：COM1                   │
   │   波特率：38400               │
   └────────────────────────────────┘
```

### 2.5 威纶通HMI连接配置

**EBPro配置**：

```
1. 新建工程
   文件 → 新建工程
   选择HMI型号
   
2. 系统参数设置
   编辑 → 系统参数 → 设备列表
   
3. 添加PLC设备
   ┌────────────────────────────────┐
   │ 设备类型：                      │
   │   - SIEMENS S7-1200 (以太网)   │
   │   - Mitsubishi FX (串口)       │
   │   - Modbus RTU/TCP            │
   │                                │
   │ 连接参数：                      │
   │   IP：192.168.0.1             │
   │   端口：102 (S7)              │
   │   超时：3000ms                │
   └────────────────────────────────┘
```

---

## 三、变量映射与数据交换

### 3.1 变量类型

```
HMI变量分类：
┌─────────────────────────────────────────┐
│ 外部变量（PLC变量）                      │
│   - 直接读写PLC数据                     │
│   - 需要通信连接                        │
│   - 如：DB1.DBW0、M0.0、VD100          │
├─────────────────────────────────────────┤
│ 内部变量（HMI变量）                      │
│   - 存储在HMI本地                       │
│   - 不占用通信资源                      │
│   - 用于画面内部数据                    │
├─────────────────────────────────────────┤
│ 系统变量                                │
│   - HMI系统提供                        │
│   - 如：日期时间、画面编号              │
└─────────────────────────────────────────┘
```

### 3.2 变量地址映射

**西门子S7变量映射**：

| HMI变量类型 | PLC地址示例 | 说明 |
|:------------|:------------|:-----|
| Bool | DB1.DBX0.0 | DB1第0字节第0位 |
| Int | DB1.DBW10 | DB1第10字节开始的字 |
| DInt | DB1.DBD20 | DB1第20字节开始的双字 |
| Real | DB1.DBD30 | 浮点数 |
| String | DB1.DBB40 | 字符串 |
| M位 | M100.0 | M区位地址 |
| MW | MW200 | M区字地址 |

**三菱PLC变量映射**：

| HMI变量类型 | PLC地址示例 | 说明 |
|:------------|:------------|:-----|
| Bit | M100 | M继电器 |
| Bit | X0 | 输入继电器 |
| Bit | Y0 | 输出继电器 |
| Word | D100 | 数据寄存器 |
| DWord | D200 | 双字(D200-D201) |
| Float | D300 | 浮点数(D300-D301) |

### 3.3 采集周期设置

```
变量采集周期建议：
┌────────────────────────────────────────────┐
│ 采集周期 │ 应用场景                         │
├──────────┼──────────────────────────────────┤
│ 100ms   │ 实时状态显示、动画              │
│ 250ms   │ 数值显示、趋势曲线              │
│ 500ms   │ 一般监控数据                    │
│ 1s      │ 非关键参数                      │
│ 按需    │ 报警触发、事件驱动              │
└────────────────────────────────────────────┘

注意事项：
- 采集周期过短会增加通信负担
- 根据数据重要性分级设置
- 报警变量建议使用快速采集
```

### 3.4 数据格式转换

```
常用数据转换：

1. 模拟量标定
   工程值 = (原始值 - 原始下限) × (工程上限 - 工程下限)
            ─────────────────────────────────────
                  (原始上限 - 原始下限)
            + 工程下限
   
   示例：0-27648 → 0-100%
   百分比 = 原始值 × 100 / 27648

2. BCD转换
   BCD码(16进制) → 十进制显示
   0x1234 → 1234
   
3. 位组合/分解
   字节 = Bit7×128 + Bit6×64 + ... + Bit0×1
```

---

## 四、画面设计基础

### 4.1 画面类型

```
典型HMI画面结构：
┌─────────────────────────────────────────┐
│              系统导航画面               │
│  (主画面，含导航按钮)                   │
└─────────────────────────────────────────┘
           │
    ┌──────┼──────┐
    │      │      │
┌───┴───┐┌─┴──┐┌──┴───┐
│工艺流程││参数 ││报警  │
│ 画面   ││设置 ││画面  │
└────────┘└────┘└──────┘
    │
┌───┴───┐
│设备详情│
│ 弹出窗 │
└────────┘
```

**常用画面类型**：

| 画面类型 | 功能说明 | 示例内容 |
|:---------|:---------|:---------|
| 总览画面 | 系统概览 | 设备状态、产量、运行状态 |
| 工艺画面 | 流程显示 | 管道、阀门、设备动画 |
| 参数画面 | 设定参数 | 温度设定、速度调整 |
| 趋势画面 | 历史曲线 | 温度、压力变化趋势 |
| 报警画面 | 报警列表 | 当前报警、历史报警 |
| 配方画面 | 配方管理 | 配方选择、编辑 |
| 用户画面 | 权限管理 | 登录、注销、权限设置 |

### 4.2 画面元素

```
常用画面对象：
┌─────────────────────────────────────────────────┐
│ 显示类                                          │
│   文本框、数值显示、状态指示灯                  │
│   棒图、仪表盘、趋势曲线                        │
├─────────────────────────────────────────────────┤
│ 操作类                                          │
│   按钮、开关、滑块                              │
│   数值输入、选择列表                            │
├─────────────────────────────────────────────────┤
│ 动画类                                          │
│   管道流动、设备运转                            │
│   填充动画、位置移动                            │
├─────────────────────────────────────────────────┤
│ 导航类                                          │
│   画面切换按钮                                  │
│   弹出窗口、下拉菜单                            │
└─────────────────────────────────────────────────┘
```

### 4.3 动画效果

**常用动画类型**：

```
1. 可见性动画
   条件：PLC位变量
   效果：显示/隐藏
   应用：故障指示灯
   
   IF Motor_Running THEN
       显示运行图标
   ELSE
       显示停止图标
   END_IF

2. 填充动画
   变量：液位值(0-100%)
   效果：从下到上填充
   应用：液位显示
   
   填充高度 = 容器高度 × 液位值 / 100

3. 位置动画
   变量：位置值
   效果：对象移动
   应用：传送带上物料
   
   X坐标 = 起始位置 + 位置值 × 像素/单位

4. 旋转动画
   变量：角度/速度
   效果：对象旋转
   应用：电机、风扇
   
   旋转角度 = 旋转角度 + 速度 × 周期
```

### 4.4 画面设计示例

**电机控制画面布局**：

```
┌─────────────────────────────────────────────────────┐
│  [标题栏]     电机控制画面           2024-01-15    │
├─────────────────────────────────────────────────────┤
│                                                      │
│   ┌──────────┐     状态: [●] 运行中                │
│   │          │                                      │
│   │  电机    │     速度: [  1500  ] RPM            │
│   │  动画    │                                      │
│   │          │     电流: [  12.5  ] A              │
│   │    M     │                                      │
│   │          │     温度: [  45.2  ] ℃              │
│   └──────────┘                                      │
│                                                      │
│   ┌─────┐  ┌─────┐  ┌─────┐                       │
│   │启动 │  │停止 │  │复位 │                       │
│   └─────┘  └─────┘  └─────┘                       │
│                                                      │
│   速度设定: [________] RPM  [确认]                  │
│                                                      │
├─────────────────────────────────────────────────────┤
│  [主画面] [参数] [报警] [趋势]          [返回]     │
└─────────────────────────────────────────────────────┘
```

### 4.5 画面设计规范

```
HMI画面设计原则：
┌─────────────────────────────────────────────────┐
│ 1. 布局规范                                     │
│    - 重要信息放在显眼位置                       │
│    - 操作按钮大小适中(≥40×40像素)             │
│    - 保持画面简洁，避免过度拥挤                 │
├─────────────────────────────────────────────────┤
│ 2. 颜色规范                                     │
│    - 红色：报警、停止、故障                     │
│    - 绿色：运行、正常、启动                     │
│    - 黄色：警告、注意                           │
│    - 蓝色：信息、手动                           │
│    - 灰色：未激活、禁用                         │
├─────────────────────────────────────────────────┤
│ 3. 文字规范                                     │
│    - 字体大小≥12pt                             │
│    - 使用清晰易读的字体                         │
│    - 标签与数值对齐                             │
├─────────────────────────────────────────────────┤
│ 4. 交互规范                                     │
│    - 重要操作需二次确认                         │
│    - 提供明确的操作反馈                         │
│    - 导航结构清晰，层级不超过3层               │
└─────────────────────────────────────────────────┘
```

---

## 五、报警系统配置

### 5.1 报警类型

| 报警类型 | 触发方式 | 应用场景 |
|:---------|:---------|:---------|
| 位报警 | Bool变量=1 | 开关量故障 |
| 模拟量报警 | 超上下限 | 温度、压力越限 |
| 事件报警 | 状态变化 | 启停、模式切换 |
| 系统报警 | HMI内部 | 通信故障 |

### 5.2 报警配置

**西门子TIA Portal报警配置**：

```
报警参数设置：
┌────────────────────────────────────────────┐
│ 报警类：自定义报警类                        │
│                                            │
│ 报警1：                                    │
│   触发变量：DB100.DBX0.0                   │
│   报警文本：电机过载保护动作               │
│   报警类别：故障                           │
│   优先级：高                               │
│                                            │
│ 报警2：                                    │
│   触发变量：DB100.DBD10                    │
│   报警方式：高限报警                       │
│   上限值：100.0                            │
│   报警文本：温度过高 当前值:%f℃           │
│   报警类别：警告                           │
└────────────────────────────────────────────┘
```

### 5.3 报警画面设计

```
报警画面布局：
┌─────────────────────────────────────────────────────┐
│  当前报警    [确认] [确认全部] [筛选▼]             │
├───┬────────┬──────────────────────┬────────┬───────┤
│ # │ 时间   │ 报警信息             │ 状态   │ 操作  │
├───┼────────┼──────────────────────┼────────┼───────┤
│ 1 │ 10:25  │ 电机M1过载           │ ● 活动 │ [确认]│
│ 2 │ 10:20  │ 温度传感器T1故障     │ ● 活动 │ [确认]│
│ 3 │ 09:45  │ 压力过高报警         │ ○ 已确认│       │
│ 4 │ 09:30  │ 液位低报警           │ ○ 已恢复│       │
└───┴────────┴──────────────────────┴────────┴───────┘
│                                                     │
│ 报警统计：活动:2  已确认:1  已恢复:1              │
└─────────────────────────────────────────────────────┘

报警状态图标：
● 红色闪烁 - 未确认活动报警
● 红色常亮 - 已确认活动报警
○ 黄色    - 已恢复未确认
○ 绿色    - 已恢复已确认
```

### 5.4 报警记录与查询

```
报警历史功能：
┌────────────────────────────────────────────┐
│ 存储方式：                                 │
│   - HMI内部存储（CF卡/U盘）              │
│   - 数据库存储（SQL Server）              │
│                                            │
│ 查询条件：                                 │
│   - 时间范围                              │
│   - 报警类别                              │
│   - 报警级别                              │
│   - 设备区域                              │
│                                            │
│ 导出格式：                                 │
│   - CSV文件                               │
│   - Excel表格                             │
│   - PDF报表                               │
└────────────────────────────────────────────┘
```

---

## 六、历史趋势与数据记录

### 6.1 趋势曲线配置

```
趋势曲线参数：
┌────────────────────────────────────────────┐
│ 变量配置：                                 │
│   变量1：温度PV（红色）                    │
│   变量2：温度SP（蓝色）                    │
│   变量3：加热输出（绿色）                  │
│                                            │
│ 时间设置：                                 │
│   采集周期：1秒                            │
│   显示范围：10分钟                         │
│   存储周期：5秒                            │
│                                            │
│ 显示设置：                                 │
│   Y轴范围：0-150                           │
│   网格显示：开                             │
│   标尺显示：开                             │
└────────────────────────────────────────────┘
```

### 6.2 趋势画面示例

```
趋势曲线画面：
┌─────────────────────────────────────────────────────┐
│  温度趋势曲线              [实时] [历史] [导出]    │
├─────────────────────────────────────────────────────┤
│ 150│                                               │
│    │         ╱╲                                    │
│ 100│    ╱──╲╱  ╲──────────   ← 温度PV            │
│    │   ╱                                           │
│  50│──╱─────────────────────  ← 温度SP            │
│    │                                               │
│   0└───────────────────────────────────────────── │
│     10:00  10:02  10:04  10:06  10:08  10:10      │
├─────────────────────────────────────────────────────┤
│ ■温度PV: 85.5℃  ■温度SP: 80.0℃  ■输出: 45%      │
└─────────────────────────────────────────────────────┘
```

### 6.3 数据归档配置

```
数据归档设置：
┌────────────────────────────────────────────────────┐
│ 归档变量：                                         │
│   - 温度1 (每5秒记录)                             │
│   - 压力1 (每10秒记录)                            │
│   - 流量1 (每5秒记录)                             │
│   - 产量  (每分钟记录)                            │
│                                                    │
│ 存储位置：                                         │
│   - 内部存储：1GB                                 │
│   - 外部存储：USB/CF卡                            │
│   - 网络存储：共享文件夹                          │
│                                                    │
│ 存储策略：                                         │
│   - 循环覆盖：存满后覆盖最旧数据                  │
│   - 自动备份：每天00:00备份                       │
│   - 保留天数：30天                                │
└────────────────────────────────────────────────────┘
```

---

## 七、用户权限管理

### 7.1 用户等级

```
典型权限等级设置：
┌──────┬────────────────────────────────────────────┐
│ 等级 │ 权限范围                                   │
├──────┼────────────────────────────────────────────┤
│ 操作员│ 查看画面、基本操作                        │
│ (1级) │ 启停设备、查看报警                        │
├──────┼────────────────────────────────────────────┤
│ 班长  │ 操作员权限 +                              │
│ (2级) │ 参数修改、报警确认                        │
├──────┼────────────────────────────────────────────┤
│ 工程师│ 班长权限 +                                │
│ (3级) │ 配方修改、系统参数                        │
├──────┼────────────────────────────────────────────┤
│ 管理员│ 全部权限                                  │
│ (4级) │ 用户管理、系统配置                        │
└──────┴────────────────────────────────────────────┘
```

### 7.2 登录界面设计

```
登录弹窗：
┌───────────────────────────────┐
│         用户登录               │
├───────────────────────────────┤
│                               │
│  用户名: [______________]     │
│                               │
│  密  码: [**************]     │
│                               │
│      [登录]    [取消]         │
│                               │
│  当前用户: 访客               │
│  登录时间: --                 │
└───────────────────────────────┘

安全设置：
- 密码长度≥6位
- 错误次数限制（3次锁定）
- 自动注销时间（15分钟无操作）
- 操作日志记录
```

---

## 八、配方管理

### 8.1 配方结构

```
配方系统结构：
┌─────────────────────────────────────────────────┐
│                  配方表                         │
├──────────┬─────────┬─────────┬─────────────────┤
│ 配方名称  │ 参数1   │ 参数2   │ 参数3          │
├──────────┼─────────┼─────────┼─────────────────┤
│ 产品A    │  100    │  50.0   │  1200          │
│ 产品B    │  150    │  60.0   │  1500          │
│ 产品C    │  200    │  70.0   │  1800          │
└──────────┴─────────┴─────────┴─────────────────┘

配方操作：
1. 选择配方
2. 下载到PLC
3. 从PLC上传
4. 保存配方
5. 删除配方
```

### 8.2 配方画面示例

```
配方管理画面：
┌─────────────────────────────────────────────────────┐
│  配方管理                                           │
├─────────────────────────────────────────────────────┤
│  配方列表：              配方参数：                 │
│  ┌──────────────┐        ┌────────────────────┐   │
│  │► 产品A      │        │ 温度设定: [100] ℃ │   │
│  │  产品B      │        │ 压力设定: [50.0]Bar│   │
│  │  产品C      │        │ 速度设定: [1200]RPM│   │
│  │             │        │ 时间设定: [30] min │   │
│  └──────────────┘        └────────────────────┘   │
│                                                     │
│  [新建] [删除] [重命名]    [下载] [上传] [保存]   │
│                                                     │
│  当前配方: 产品A          状态: 已下载             │
└─────────────────────────────────────────────────────┘
```

---

## 九、HMI项目实例

### 9.1 项目需求

设计一个水处理系统HMI：

```
系统组成：
┌─────────────────────────────────────────────────┐
│ 设备清单：                                      │
│   - 进水泵 P1                                   │
│   - 出水泵 P2                                   │
│   - 加药泵 P3                                   │
│   - 液位传感器 LT1、LT2                        │
│   - 流量计 FT1                                  │
│   - pH传感器 AIT1                              │
│                                                 │
│ 功能需求：                                      │
│   - 工艺流程监控                               │
│   - 设备手动/自动控制                          │
│   - 参数设定与显示                             │
│   - 报警管理                                   │
│   - 历史趋势                                   │
└─────────────────────────────────────────────────┘
```

### 9.2 画面规划

```
画面结构：
┌─────────────────────────────────────────────────┐
│                    主画面                        │
│               (系统概览导航)                     │
└─────────────────────────────────────────────────┘
           │
    ┌──────┼──────┬──────┐
    │      │      │      │
┌───┴───┐┌─┴──┐┌──┴──┐┌──┴───┐
│工艺流程││参数 ││报警  ││趋势  │
│ 画面  ││设定 ││画面  ││画面  │
└───────┘└────┘└─────┘└──────┘

画面编号分配：
- 画面1: 主画面
- 画面2: 工艺流程
- 画面3: 参数设定
- 画面4: 报警列表
- 画面5: 历史趋势
- 画面10-19: 弹出窗口
```

### 9.3 变量表设计

```
PLC-HMI变量映射表：
┌───────────────┬──────────────┬──────────────────┐
│ HMI变量名     │ PLC地址      │ 说明             │
├───────────────┼──────────────┼──────────────────┤
│ P1_Run        │ DB1.DBX0.0   │ 进水泵运行状态   │
│ P1_Fault      │ DB1.DBX0.1   │ 进水泵故障       │
│ P1_Start_Cmd  │ DB1.DBX1.0   │ 进水泵启动命令   │
│ P1_Stop_Cmd   │ DB1.DBX1.1   │ 进水泵停止命令   │
│ LT1_Value     │ DB1.DBD10    │ 水池1液位 (%)    │
│ LT2_Value     │ DB1.DBD14    │ 水池2液位 (%)    │
│ FT1_Value     │ DB1.DBD18    │ 流量 (m³/h)      │
│ AIT1_Value    │ DB1.DBD22    │ pH值             │
│ LT1_High_SP   │ DB1.DBD30    │ 液位高限设定     │
│ LT1_Low_SP    │ DB1.DBD34    │ 液位低限设定     │
│ Mode_Auto     │ DB1.DBX2.0   │ 自动模式         │
└───────────────┴──────────────┴──────────────────┘
```

### 9.4 报警配置表

```
报警定义表：
┌────┬────────────────┬────────────┬──────┬──────┐
│ ID │ 报警文本       │ 触发条件   │ 级别 │ 类别 │
├────┼────────────────┼────────────┼──────┼──────┤
│ 1  │ 进水泵P1故障   │ P1_Fault=1│ 高   │ 故障 │
│ 2  │ 出水泵P2故障   │ P2_Fault=1│ 高   │ 故障 │
│ 3  │ 水池1液位过高  │ LT1>90%   │ 高   │ 报警 │
│ 4  │ 水池1液位过低  │ LT1<10%   │ 中   │ 警告 │
│ 5  │ pH值异常       │ pH<6或>9  │ 中   │ 警告 │
│ 6  │ 通信故障       │ 系统检测   │ 高   │ 故障 │
└────┴────────────────┴────────────┴──────┴──────┘
```

---

## 十、调试与维护

### 10.1 HMI在线调试

```
调试方法：
┌────────────────────────────────────────────────────┐
│ 1. 模拟器调试                                      │
│    - 使用软件自带模拟功能                          │
│    - 无需实际PLC和HMI硬件                         │
│    - 快速验证画面逻辑                              │
│                                                    │
│ 2. 在线监控                                        │
│    - 连接实际设备                                  │
│    - 监视变量实时值                                │
│    - 修改变量进行测试                              │
│                                                    │
│ 3. 交叉引用                                        │
│    - 检查变量使用情况                              │
│    - 发现未使用的变量                              │
│    - 排查地址冲突                                  │
└────────────────────────────────────────────────────┘
```

### 10.2 常见问题处理

| 问题 | 可能原因 | 解决方法 |
|:-----|:---------|:---------|
| 无法通信 | 参数不匹配 | 检查IP、端口、协议 |
| | 线缆故障 | 检查网线/串口线 |
| 显示###### | 变量地址错误 | 核对PLC地址 |
| | 数据类型不匹配 | 检查数据格式 |
| 画面卡顿 | 变量过多 | 减少采集变量 |
| | 采集周期过短 | 延长采集周期 |
| 报警不触发 | 触发条件错误 | 检查报警配置 |

---

## 十一、实践练习

### 练习1：HMI通信配置

配置威纶通HMI与西门子S7-1200的以太网通信：
- HMI IP: 192.168.0.2
- PLC IP: 192.168.0.1
- 读取DB1中的10个Word数据

### 练习2：画面设计

设计一个电机控制画面，包含：
- 电机运行状态指示（动画）
- 启动/停止按钮
- 速度显示和设定
- 电流、温度显示
- 故障报警指示

### 练习3：报警系统

为练习2的电机控制系统配置报警：
- 过载报警（电流>额定值120%）
- 过温报警（温度>80℃）
- 通信故障报警
- 设计报警列表画面

---

## 本节小结

1. **HMI**是自动化系统人机交互的重要组成部分
2. **通信配置**是HMI应用的基础，需正确设置协议和参数
3. **变量映射**将PLC数据与HMI画面元素关联
4. **画面设计**应遵循规范，注重实用性和易用性
5. **报警系统**是保障生产安全的重要功能
6. **权限管理**确保系统操作安全可控

---

## 思考题

1. HMI与PLC通信有哪些常用方式？各有什么特点？
2. 变量采集周期如何设置才合理？
3. 画面设计时颜色使用有什么规范？
4. 如何设计一个完善的报警系统？
5. HMI调试过程中常见问题有哪些？如何解决？

---

> **下一章预告**：第七章 实战项目案例 - 通过实际案例综合运用所学知识
