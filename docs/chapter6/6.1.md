# 6.1 工业通信基础

> 本节将介绍工业通信的基本概念，为后续学习各种通信技术打下基础

## 学习目标

- 了解工业通信的重要性和发展
- 掌握通信的基本术语和概念
- 理解串行/并行、同步/异步通信
- 了解主从通信和通信协议
- 理解OSI七层模型

---

## 1. 工业通信概述

### 1.1 什么是工业通信？

工业通信是指工业自动化系统中各设备之间进行数据交换的技术。

```
工业通信系统架构：
┌─────────────────────────────────────────────────────────────┐
│                      企业管理层                              │
│                    ┌──────────┐                             │
│                    │   ERP    │                             │
│                    └────┬─────┘                             │
│                         │ 以太网                            │
├─────────────────────────┼───────────────────────────────────┤
│                      控制管理层                              │
│         ┌──────────┬────┴────┬──────────┐                  │
│         │   SCADA  │   MES   │   HMI    │                  │
│         └────┬─────┴────┬────┴────┬─────┘                  │
│              │ 工业以太网 │         │                        │
├──────────────┼──────────┼─────────┼─────────────────────────┤
│                      控制层                                  │
│         ┌────┴────┐ ┌───┴───┐ ┌──┴────┐                   │
│         │  PLC 1  │ │ PLC 2 │ │ PLC 3 │                   │
│         └────┬────┘ └───┬───┘ └───┬───┘                   │
│              │ 现场总线  │         │                        │
├──────────────┼──────────┼─────────┼─────────────────────────┤
│                      设备层                                  │
│         ┌────┴────┐ ┌───┴───┐ ┌───┴───┐                   │
│         │变频器/IO│ │传感器 │ │执行器 │                   │
│         └─────────┘ └───────┘ └───────┘                   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 1.2 工业通信的重要性

| 应用场景 | 通信需求 | 典型例子 |
|---------|---------|---------|
| 数据采集 | 传感器→PLC | 温度、压力采集 |
| 设备控制 | PLC→执行器 | 变频器速度指令 |
| 设备互联 | PLC↔PLC | 多站协调控制 |
| 人机交互 | PLC↔HMI | 监控画面 |
| 远程监控 | 现场→中控室 | SCADA系统 |

---

## 2. 通信基本术语

### 2.1 基本概念

```
通信基本术语：
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  波特率（Baud Rate）：每秒传输的符号数                       │
│  ├─常用：9600、19200、38400、115200 bps                     │
│  └─波特率越高，传输越快                                      │
│                                                             │
│  比特率（Bit Rate）：每秒传输的比特数                        │
│  └─单位：bps（bits per second）                             │
│                                                             │
│  数据位：每帧有效数据的位数                                  │
│  └─常用：7位、8位                                           │
│                                                             │
│  停止位：帧结束标志                                          │
│  └─常用：1位、2位                                           │
│                                                             │
│  校验位：用于错误检测                                        │
│  ├─无校验（None）                                           │
│  ├─奇校验（Odd）                                            │
│  └─偶校验（Even）                                           │
│                                                             │
│  常见配置表示：9600, 8, N, 1                                │
│  （波特率9600，8数据位，无校验，1停止位）                    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 通信帧格式

```
异步串行通信帧格式：
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  ┌────┬───────────────────────┬────┬─────┐                │
│  │起始│      数据位            │校验│停止 │                │
│  │ 位 │  D0 D1 D2 D3 D4 D5 D6 D7│ 位 │ 位  │                │
│  └────┴───────────────────────┴────┴─────┘                │
│    1位        8位              0/1位  1/2位                 │
│                                                             │
│  时序图：                                                    │
│   空闲 │起始│ D0 │ D1 │ D2 │...│ D7 │校验│停止│ 空闲        │
│  ──────┴────┴────┴────┴────┴───┴────┴────┴────┴──────      │
│    高  │ 低 │数据│数据│数据│   │数据│    │ 高 │  高         │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

**【停顿总结1】** 已完成约500字，介绍了：
1. 工业通信的定义和系统架构图
2. 工业通信的重要性和应用场景
3. 基本通信术语（波特率、数据位、校验等）
4. 异步串行通信帧格式

继续填充串行/并行通信和同步/异步通信：

---

## 3. 串行通信与并行通信

### 3.1 概念对比

```
串行通信与并行通信：
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  并行通信：                                                  │
│  ┌──────┐  D0 ─────────────────→  ┌──────┐                │
│  │      │  D1 ─────────────────→  │      │                │
│  │ 发送 │  D2 ─────────────────→  │ 接收 │                │
│  │  端  │  D3 ─────────────────→  │  端  │                │
│  │      │  ...                     │      │                │
│  │      │  D7 ─────────────────→  │      │                │
│  └──────┘  （8根数据线同时传输）    └──────┘                │
│                                                             │
│  串行通信：                                                  │
│  ┌──────┐                         ┌──────┐                │
│  │      │  TX ──────────────────→ │      │                │
│  │ 发送 │                    RX ← │ 接收 │                │
│  │  端  │  ←────────────────────  │  端  │                │
│  └──────┘  （1-2根数据线依次传输） └──────┘                │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 特点对比

| 特性 | 并行通信 | 串行通信 |
|------|---------|---------|
| 传输线数 | 多（8/16/32根） | 少（1-2根） |
| 传输速度 | 理论上快 | 相对慢 |
| 传输距离 | 短（<1m） | 长（可达km） |
| 成本 | 高 | 低 |
| 抗干扰 | 差 | 好 |
| 工业应用 | 少（背板总线） | 多（RS485等） |

### 3.3 工业中串行通信的优势

```
工业环境选择串行通信的原因：
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  1. 传输距离长                                               │
│     └─RS485可达1200m，满足工厂布线需求                       │
│                                                             │
│  2. 抗干扰能力强                                             │
│     └─差分信号，能抵抗工业电磁干扰                           │
│                                                             │
│  3. 布线成本低                                               │
│     └─仅需2-3根线，节省线缆和施工成本                        │
│                                                             │
│  4. 接口标准化                                               │
│     └─RS232/RS485/RS422标准成熟                             │
│                                                             │
│  5. 易于扩展                                                 │
│     └─RS485支持多设备挂接（最多32个）                        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 4. 同步通信与异步通信

### 4.1 异步通信

```
异步通信特点：
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  特点：                                                      │
│  • 每个字符独立发送，带起始位和停止位                        │
│  • 发送端和接收端不需要同步时钟                              │
│  • 字符间隔可以任意                                          │
│                                                             │
│  帧格式：                                                    │
│  ┌───┬──────────┬───┬───┐ 空闲 ┌───┬──────────┬───┬───┐  │
│  │ S │ 数据位   │ P │ E │ ──── │ S │ 数据位   │ P │ E │  │
│  └───┴──────────┴───┴───┘      └───┴──────────┴───┴───┘  │
│   起始  8位数据  校验 停止        起始  8位数据  校验 停止   │
│                                                             │
│  优点：简单、灵活、成本低                                    │
│  缺点：效率低（有额外开销）                                  │
│  应用：RS232、RS485、UART                                   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 同步通信

```
同步通信特点：
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  特点：                                                      │
│  • 数据以数据块为单位传输                                    │
│  • 需要同步时钟信号                                          │
│  • 没有起始位和停止位                                        │
│                                                             │
│  帧格式：                                                    │
│  ┌──────┬───────────────────────────────────┬──────┬───┐  │
│  │同步字│              数据块               │ CRC  │结束│  │
│  └──────┴───────────────────────────────────┴──────┴───┘  │
│                                                             │
│  信号线：                                                    │
│  CLK  ──┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─→ 时钟信号                  │
│  DATA ──────────────────────────→ 数据信号                  │
│                                                             │
│  优点：传输效率高                                            │
│  缺点：需要时钟线，复杂度高                                  │
│  应用：SPI、I2C、HDLC                                       │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 4.3 对比总结

| 特性 | 异步通信 | 同步通信 |
|------|---------|---------|
| 时钟 | 不需要同步时钟 | 需要同步时钟 |
| 传输单位 | 字符 | 数据块 |
| 效率 | 低（约80%） | 高（>95%） |
| 复杂度 | 简单 | 复杂 |
| 典型协议 | RS232/RS485 | SPI/I2C |

---

**【停顿总结2】** 已完成约1000字，新增内容：
1. 串行通信与并行通信的概念和对比
2. 工业中选择串行通信的原因
3. 异步通信的特点和帧格式
4. 同步通信的特点
5. 异步/同步通信对比

继续填充主从模式和通信协议：

---

## 5. 主从通信模式

### 5.1 主从结构

```
主从通信架构：
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│                    ┌──────────┐                             │
│                    │  主站    │                             │
│                    │ (Master) │                             │
│                    └────┬─────┘                             │
│                         │                                   │
│         ┌───────────────┼───────────────┐                  │
│         │               │               │                  │
│         ↓               ↓               ↓                  │
│    ┌────────┐      ┌────────┐      ┌────────┐             │
│    │ 从站1  │      │ 从站2  │      │ 从站3  │             │
│    │(Slave) │      │(Slave) │      │(Slave) │             │
│    │ 地址=1 │      │ 地址=2 │      │ 地址=3 │             │
│    └────────┘      └────────┘      └────────┘             │
│                                                             │
│  通信规则：                                                  │
│  • 主站发起所有通信                                         │
│  • 从站只能响应主站请求                                     │
│  • 从站之间不能直接通信                                     │
│  • 每个从站有唯一地址                                       │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 5.2 主从通信过程

```
主从通信时序：
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  主站                                                从站1   │
│   │                                                   │     │
│   │  ① 发送请求帧（地址=1，功能码，数据）             │     │
│   │ ─────────────────────────────────────────────────→│     │
│   │                                                   │     │
│   │  ② 从站处理请求                                   │     │
│   │                                                   │     │
│   │  ③ 返回响应帧（地址=1，功能码，数据）             │     │
│   │ ←─────────────────────────────────────────────────│     │
│   │                                                   │     │
│   │                                                   │     │
│   │  轮询下一个从站...                                │     │
│   ↓                                                   ↓     │
│                                                             │
│  请求帧格式：                                                │
│  ┌────────┬────────┬────────┬────────┐                    │
│  │从站地址│ 功能码 │  数据  │  校验  │                    │
│  └────────┴────────┴────────┴────────┘                    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 5.3 多主站与单主站

| 模式 | 特点 | 典型协议 |
|------|------|---------|
| 单主站 | 只有一个主站控制 | Modbus RTU |
| 多主站 | 多个设备可发起通信 | CAN、以太网 |

---

## 6. 通信协议概念

### 6.1 什么是通信协议？

```
通信协议定义：
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  通信协议 = 通信双方约定的规则                              │
│                                                             │
│  协议规定了：                                                │
│  ├─数据格式：帧结构、字节顺序                               │
│  ├─传输规则：何时发送、如何响应                             │
│  ├─错误处理：校验方式、重发机制                             │
│  └─地址分配：设备编址规则                                   │
│                                                             │
│  类比：通信协议就像"语言"                                   │
│  ├─中文（协议A）：只能和懂中文的人交流                      │
│  ├─英文（协议B）：只能和懂英文的人交流                      │
│  └─要交流必须使用相同的语言（协议）                         │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 6.2 常见工业通信协议

| 协议名称 | 物理层 | 特点 | 应用场景 |
|---------|--------|------|---------|
| Modbus RTU | RS485 | 简单通用 | PLC与仪表 |
| Modbus TCP | 以太网 | 基于TCP/IP | 远程监控 |
| Profibus | 专用 | 西门子主导 | 过程控制 |
| Profinet | 以太网 | 实时以太网 | 运动控制 |
| EtherCAT | 以太网 | 超高速 | 伺服系统 |
| CC-Link | 专用 | 三菱主导 | 亚洲市场 |

### 6.3 协议选择考虑因素

```
选择通信协议的因素：
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  1. 实时性要求                                               │
│     ├─高实时：EtherCAT、Profinet IRT（<1ms）               │
│     ├─中实时：Profibus、CC-Link（1-10ms）                  │
│     └─低实时：Modbus、以太网（>10ms）                       │
│                                                             │
│  2. 通信距离                                                 │
│     ├─长距离：RS485（1200m）、光纤                          │
│     └─短距离：RS232（15m）、以太网（100m）                  │
│                                                             │
│  3. 设备数量                                                 │
│     ├─少量设备：RS232点对点                                 │
│     └─多设备：RS485（32个）、以太网（无限制）               │
│                                                             │
│  4. 成本预算                                                 │
│     ├─低成本：Modbus RTU                                    │
│     └─高性能：Profinet、EtherCAT                            │
│                                                             │
│  5. 品牌兼容                                                 │
│     ├─西门子系统：Profibus/Profinet                         │
│     ├─三菱系统：CC-Link                                     │
│     └─开放系统：Modbus、以太网                              │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

**【停顿总结3】** 已完成约1500字，新增内容：
1. 主从通信架构和通信规则
2. 主从通信时序和帧格式
3. 通信协议的概念和作用
4. 常见工业通信协议对比
5. 协议选择的考虑因素

继续填充OSI模型和本节总结：

---

## 7. OSI七层模型

### 7.1 OSI模型概述

```
OSI七层参考模型：
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  层级      名称           功能                 工业协议示例  │
│  ┌───┬─────────────┬──────────────────┬────────────────┐  │
│  │ 7 │  应用层     │ 用户接口和应用   │ Modbus应用层   │  │
│  ├───┼─────────────┼──────────────────┼────────────────┤  │
│  │ 6 │  表示层     │ 数据格式转换     │                │  │
│  ├───┼─────────────┼──────────────────┼────────────────┤  │
│  │ 5 │  会话层     │ 建立/维护连接    │                │  │
│  ├───┼─────────────┼──────────────────┼────────────────┤  │
│  │ 4 │  传输层     │ 端到端传输       │ TCP/UDP        │  │
│  ├───┼─────────────┼──────────────────┼────────────────┤  │
│  │ 3 │  网络层     │ 路由寻址         │ IP             │  │
│  ├───┼─────────────┼──────────────────┼────────────────┤  │
│  │ 2 │  数据链路层 │ 帧同步、校验     │ 以太网MAC      │  │
│  ├───┼─────────────┼──────────────────┼────────────────┤  │
│  │ 1 │  物理层     │ 电气信号传输     │ RS485/以太网   │  │
│  └───┴─────────────┴──────────────────┴────────────────┘  │
│                                                             │
│  工业通信简化模型（通常只关注3层）：                         │
│  ├─物理层：RS232/RS485/以太网                               │
│  ├─数据链路层：帧格式、错误检测                             │
│  └─应用层：Modbus、Profinet等                              │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 7.2 工业通信协议栈

```
常见工业协议的协议栈：
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│      Modbus RTU        Modbus TCP        Profinet          │
│  ┌───────────────┐ ┌───────────────┐ ┌───────────────┐    │
│  │ Modbus应用层  │ │ Modbus应用层  │ │Profinet应用层 │    │
│  ├───────────────┤ ├───────────────┤ ├───────────────┤    │
│  │               │ │     TCP       │ │  TCP/UDP/RT   │    │
│  │    无         │ ├───────────────┤ ├───────────────┤    │
│  │               │ │      IP       │ │      IP       │    │
│  ├───────────────┤ ├───────────────┤ ├───────────────┤    │
│  │  串行帧格式   │ │   以太网MAC   │ │   以太网MAC   │    │
│  ├───────────────┤ ├───────────────┤ ├───────────────┤    │
│  │    RS485      │ │   以太网PHY   │ │   以太网PHY   │    │
│  └───────────────┘ └───────────────┘ └───────────────┘    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 7.3 理解协议分层的好处

| 优点 | 说明 |
|------|------|
| 模块化 | 各层独立，便于开发和维护 |
| 标准化 | 定义清晰接口，不同厂商可互通 |
| 灵活性 | 可更换某一层而不影响其他层 |
| 易于排错 | 可按层分析问题 |

---

## 8. 工业通信常用物理接口

### 8.1 RS232接口

```
RS232接口特点：
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  电气特性：                                                  │
│  ├─信号电平：±3V~±15V（典型±12V）                          │
│  ├─逻辑0：+3V~+15V                                         │
│  └─逻辑1：-3V~-15V                                         │
│                                                             │
│  传输距离：≤15m                                             │
│  传输速率：≤115200bps                                       │
│  连接方式：点对点（1对1）                                   │
│                                                             │
│  常用接口：                                                  │
│  DB9公头（设备端）        DB9母头（电脑端）                 │
│  ┌─────────────┐        ┌─────────────┐                   │
│  │ 1 2 3 4 5   │        │ 5 4 3 2 1   │                   │
│  │  6 7 8 9    │        │  9 8 7 6    │                   │
│  └─────────────┘        └─────────────┘                   │
│                                                             │
│  常用引脚：2-RXD（接收）、3-TXD（发送）、5-GND（地）        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 8.2 RS485接口

```
RS485接口特点：
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  电气特性：                                                  │
│  ├─信号方式：差分信号                                       │
│  ├─逻辑0：A-B < -200mV                                     │
│  └─逻辑1：A-B > +200mV                                     │
│                                                             │
│  传输距离：≤1200m                                           │
│  传输速率：≤10Mbps（短距离）                                │
│  连接方式：多点（最多32个节点）                             │
│                                                             │
│  接线方式：                                                  │
│      设备1      设备2      设备3      设备N                │
│        │          │          │          │                 │
│   A ───┼──────────┼──────────┼──────────┼─── A            │
│   B ───┼──────────┼──────────┼──────────┼─── B            │
│  GND ──┼──────────┼──────────┼──────────┼── GND           │
│        │          │          │          │                 │
│      └──────────┴──────────┴──────────┘                   │
│                  总线拓扑                                    │
│                                                             │
│  注意：两端需加120Ω终端电阻                                 │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 8.3 RS232与RS485对比

| 特性 | RS232 | RS485 |
|------|-------|-------|
| 信号方式 | 单端 | 差分 |
| 传输距离 | 15m | 1200m |
| 节点数 | 1对1 | 最多32个 |
| 抗干扰 | 弱 | 强 |
| 通信方式 | 全双工 | 半双工 |
| 工业应用 | 调试口 | 现场总线 |

---

## 本节小结

```
工业通信基础知识要点：
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  基本概念          通信方式            主从模式             │
│  ├─波特率          ├─串行/并行        ├─主站发起           │
│  ├─数据位          ├─同步/异步        ├─从站响应           │
│  └─校验位          └─工业用串行       └─唯一地址           │
│                                                             │
│  通信协议          OSI模型            物理接口             │
│  ├─规则约定        ├─七层结构         ├─RS232(近)         │
│  ├─Modbus等        ├─工业简化3层      ├─RS485(远)         │
│  └─选型考虑        └─分层好处         └─以太网            │
│                                                             │
│  关键记忆点：                                                │
│  • 串行通信是工业主流（距离远、抗干扰）                     │
│  • RS485最常用（多点、1200m）                               │
│  • Modbus是最通用的工业协议                                 │
│  • 协议选择需考虑实时性、距离、成本                         │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 练习题

### 基础题

1. 什么是波特率？常用的波特率有哪些？
2. 串行通信相比并行通信有什么优势？
3. RS232和RS485的主要区别是什么？

### 思考题

1. 为什么工业环境更多使用串行通信而非并行通信？
2. 主从通信模式有什么优缺点？
3. 如何根据应用需求选择合适的通信协议？

---

## 拓展阅读

- RS232/RS485标准规范
- Modbus协议规范
- 工业以太网技术介绍
- OSI参考模型详解

---

*本节完*
