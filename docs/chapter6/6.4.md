# 6.4 现场总线技术

> 本节将介绍常见的现场总线技术

## 学习目标

- 了解现场总线的概念、发展和优势
- 掌握PROFIBUS、CANopen、DeviceNet等总线特点
- 理解不同总线的应用场景
- 能够根据需求选择合适的总线技术

---

## 一、现场总线概述

### 1.1 现场总线定义

现场总线（Fieldbus）是连接智能现场设备和自动化系统的数字式、双向传输、多分支结构的通信网络。

```
传统控制系统 vs 现场总线系统：

传统4-20mA模拟系统：
┌─────┐    ──────    ┌─────┐
│ PLC │────────────→│传感器│  每个设备一根电缆
└─────┘    ──────    └─────┘
    │      ──────    ┌─────┐
    │────────────→│执行器│  点对点连接
         ──────    └─────┘
    大量电缆，布线复杂

现场总线系统：
┌─────┐                    
│ PLC │                    
└──┬──┘                    
   │   总线电缆            
   ╧═══╤═══╤═══╤═══╧       
       │   │   │           
    ┌──┴─┐┌┴──┐┌┴──┐       
    │设备1││设备2││设备3│    一根电缆连多设备
    └────┘└───┘└───┘       
```

### 1.2 现场总线优势

| 优势 | 说明 |
|:-----|:-----|
| 节省布线 | 一根总线连接多台设备，减少电缆用量60-70% |
| 降低成本 | 减少I/O模块、接线端子、控制柜空间 |
| 数字通信 | 精度高，抗干扰强，支持双向通信 |
| 智能诊断 | 设备自诊断，远程参数设置 |
| 互操作性 | 不同厂家设备可互联 |
| 易于扩展 | 增加设备只需接入总线 |

### 1.3 主流现场总线

```
现场总线市场份额（工业自动化）：
┌─────────────────────────────────────────┐
│ PROFIBUS     │███████████████│ 25%     │
│ Modbus       │██████████     │ 18%     │
│ CC-Link      │████████       │ 14%     │
│ DeviceNet    │██████         │ 10%     │
│ CANopen      │█████          │ 8%      │
│ AS-Interface │████           │ 6%      │
│ Foundation FF│███            │ 5%      │
│ 其他         │██████████     │ 14%     │
└─────────────────────────────────────────┘
```

### 1.4 现场总线分类

```
按应用层次分类：
┌────────────────────────────────────────────┐
│ 设备级总线      │ AS-i、IO-Link、传感器总线  │
│ (传感器/执行器) │ 简单、低成本               │
├────────────────────────────────────────────┤
│ 控制级总线      │ PROFIBUS、DeviceNet        │
│ (控制器/设备)   │ CAN、CC-Link               │
├────────────────────────────────────────────┤
│ 信息级总线      │ 工业以太网、OPC UA         │
│ (系统/企业)     │ 高速、大数据量             │
└────────────────────────────────────────────┘
```

---

## 二、PROFIBUS总线

### 2.1 PROFIBUS概述

PROFIBUS（Process Field Bus）是由西门子主导开发的现场总线标准，在欧洲和中国应用最广泛。

**PROFIBUS三种类型**：

| 类型 | 应用领域 | 传输速率 | 特点 |
|:-----|:---------|:---------|:-----|
| PROFIBUS-DP | 分布式I/O | 9.6K-12Mbps | 最常用，高速 |
| PROFIBUS-PA | 过程自动化 | 31.25Kbps | 本安防爆 |
| PROFIBUS-FMS | 复杂通信 | 9.6K-12Mbps | 已淘汰 |

### 2.2 PROFIBUS-DP技术参数

```
PROFIBUS-DP技术规格：
┌──────────────────────────────────────────┐
│ 物理层      │ RS485，9针D-Sub或M12连接器  │
│ 拓扑结构    │ 总线型                       │
│ 最大节点数  │ 126个（地址1-126）           │
│ 最大距离    │ 100m@12M，1200m@9.6K         │
│ 传输速率    │ 9.6K/19.2K/93.75K/187.5K/   │
│             │ 500K/1.5M/3M/6M/12Mbps       │
│ 电缆类型    │ 屏蔽双绞线                   │
│ 终端电阻    │ 两端各220Ω+390Ω+390Ω       │
└──────────────────────────────────────────┘
```

### 2.3 PROFIBUS传输速率与距离

| 波特率 | 每段最大距离 | 最大段数 | 总距离 |
|:-------|:-------------|:---------|:-------|
| 9.6Kbps | 1200m | 4 | 4800m |
| 19.2Kbps | 1200m | 4 | 4800m |
| 93.75Kbps | 1200m | 4 | 4800m |
| 187.5Kbps | 1000m | 4 | 4000m |
| 500Kbps | 400m | 4 | 1600m |
| 1.5Mbps | 200m | 4 | 800m |
| 12Mbps | 100m | 4 | 400m |

### 2.4 PROFIBUS网络结构

```
PROFIBUS-DP典型网络：

   ┌─────────────────────┐
   │     DP主站(PLC)     │
   │   CPU315-2DP等      │
   └──────────┬──────────┘
              │
     ═════════╧═══════════════════════════════
     RT│         │         │         │RT
       │      ┌──┴──┐   ┌──┴──┐   ┌──┴──┐
    ┌──┴──┐   │ET200│   │变频器│   │阀岛 │
    │ET200│   │ SP  │   │G120 │   │     │
    │ M   │   │#3   │   │#10  │   │#15  │
    │#2   │   └─────┘   └─────┘   └─────┘
    └─────┘   
    
    RT = 终端电阻
    # = 站地址
```

### 2.5 GSD文件

GSD（General Station Description）文件描述PROFIBUS设备的特性参数。

```
GSD文件结构：
┌──────────────────────────────────────────┐
│ [General]                                 │
│   Vendor_Name = "SIEMENS"                │
│   Model_Name = "ET 200SP"                │
│   Revision = "V1.0"                      │
│                                          │
│ [Slave_Family]                           │
│   Family_Name = "I/O"                    │
│                                          │
│ [Module]                                 │
│   模块定义...                            │
└──────────────────────────────────────────┘

TIA Portal中导入GSD：
选项 → 管理GSD文件 → 安装
```

### 2.6 西门子PROFIBUS配置

**TIA Portal配置步骤**：

```
1. 添加主站
   硬件目录 → CPU → 带DP接口的CPU
   
2. 创建DP网络
   网络视图 → PROFIBUS → 设置参数
   - 传输速率：1.5Mbps
   - 协议：DP
   
3. 添加从站
   硬件目录 → 其他现场设备 → PROFIBUS DP
   安装GSD文件后选择设备
   
4. 分配地址
   设备属性 → DP站地址：2-126
   
5. 配置I/O映射
   设备视图 → 配置模块
   设置I地址和Q地址
```

### 2.7 PROFIBUS诊断

```
诊断指令（S7-300/400）：

OB82：诊断中断OB
OB86：机架故障/站故障OB

诊断数据块：
- DPRD_DAT：读取从站诊断数据
- DPWR_DAT：写入从站数据

诊断缓冲区查看：
在线 → 诊断 → 诊断缓冲区
```

---

## 三、CAN总线与CANopen

### 3.1 CAN总线概述

CAN（Controller Area Network）由博世公司开发，最初用于汽车电子，现广泛应用于工业自动化。

**CAN总线特点**：
- 多主通信，无主从之分
- 基于优先级的仲裁
- 短帧数据（最大8字节）
- 高可靠性，广泛应用
- 传输距离：40m@1Mbps，10km@5Kbps

### 3.2 CAN帧格式

```
CAN数据帧结构（标准帧）：
┌───┬────────┬─┬─┬─┬─┬────────┬─────┬───┬─┬───┐
│SOF│标识符  │R│I│r│D│数据场  │CRC  │ACK│ │EOF│
│1位│11位    │T│D│0│L│0-8字节 │15位 │2位│ │7位│
│   │        │R│E│ │C│        │     │   │ │   │
└───┴────────┴─┴─┴─┴─┴────────┴─────┴───┴─┴───┘

SOF：帧起始
标识符：消息ID（决定优先级）
RTR：远程发送请求
IDE：标识符扩展
DLC：数据长度码
EOF：帧结束
```

### 3.3 CANopen协议

CANopen是基于CAN总线的高层应用层协议，定义了标准的通信和设备规范。

**CANopen通信对象**：

| 对象类型 | COB-ID范围 | 功能 |
|:---------|:-----------|:-----|
| NMT | 0x000 | 网络管理 |
| SYNC | 0x080 | 同步对象 |
| EMCY | 0x081-0x0FF | 紧急报警 |
| PDO | 0x180-0x57F | 过程数据 |
| SDO | 0x580-0x67F | 服务数据 |
| Heartbeat | 0x700-0x77F | 心跳监测 |

### 3.4 对象字典

```
CANopen对象字典结构：
┌────────────────────────────────────────────┐
│ 索引范围      │ 内容                       │
├──────────────┼────────────────────────────┤
│ 0x0000       │ 未使用                     │
│ 0x0001-0x001F│ 静态数据类型               │
│ 0x0020-0x003F│ 复杂数据类型               │
│ 0x0040-0x005F│ 厂商数据类型               │
│ 0x1000-0x1FFF│ 通信参数区                 │
│ 0x2000-0x5FFF│ 厂商特定参数               │
│ 0x6000-0x9FFF│ 标准设备参数               │
└────────────────────────────────────────────┘

常用对象：
0x1000：设备类型
0x1001：错误寄存器
0x1017：心跳生产者时间
0x6000：数字输入
0x6200：数字输出
```

### 3.5 PDO与SDO

```
PDO（过程数据对象）：
- 用于实时数据传输
- 无需确认，效率高
- 支持同步和异步传输
- 最多8字节数据

┌────────────┐              ┌────────────┐
│   主站     │   PDO传输    │   从站     │
│           │─────────────→│            │
│           │←─────────────│            │
└────────────┘    广播      └────────────┘

SDO（服务数据对象）：
- 用于配置和诊断
- 请求/响应模式
- 支持分段传输
- 可访问完整对象字典

┌────────────┐              ┌────────────┐
│   客户端   │   SDO请求    │   服务器   │
│           │─────────────→│            │
│           │←─────────────│   SDO响应  │
└────────────┘              └────────────┘
```

### 3.6 NMT状态机

```
CANopen NMT状态转换：

                 ┌───────────────┐
                 │   上电/复位   │
                 └───────┬───────┘
                         │
                 ┌───────▼───────┐
                 │   初始化      │
                 │ Initializing  │
                 └───────┬───────┘
            自动进入      │
                 ┌───────▼───────┐
        ┌───────│   预操作      │───────┐
        │       │ Pre-operational│       │
        │       └───────┬───────┘       │
        │               │               │
   ┌────▼────┐   ┌──────▼──────┐  ┌─────▼────┐
   │  停止   │   │    操作     │  │   复位   │
   │ Stopped │   │ Operational │  │  Reset   │
   └─────────┘   └─────────────┘  └──────────┘
```

---

## 四、DeviceNet总线

### 4.1 DeviceNet概述

DeviceNet是基于CAN的工业网络协议，由Allen-Bradley（罗克韦尔）开发，主要应用于北美市场。

**DeviceNet特点**：
- 基于CAN物理层
- 生产者/消费者模型
- 支持主/从和对等通信
- 传输速率：125K/250K/500Kbps
- 最大节点数：64个
- 最大距离：500m@125Kbps

### 4.2 DeviceNet连接类型

| 连接类型 | 说明 | 应用 |
|:---------|:-----|:-----|
| 轮询连接 | 主站轮询从站 | 周期性数据 |
| 位选通连接 | 单个命令触发多个从站 | 快速响应 |
| 状态改变连接 | 数据变化时传输 | 事件驱动 |
| 循环连接 | 固定周期传输 | 确定性要求 |

### 4.3 DeviceNet物理层

```
DeviceNet电缆规格：

粗缆（Trunk Line）：
- 线径：AWG 15
- 最大长度：500m@125K，250m@250K，100m@500K
- 功能：主干线

细缆（Drop Line）：
- 线径：AWG 22/24
- 最大长度：6m
- 功能：设备分支

连接器：
- 开放式：5针Mini接头
- 密封式：7/8" Quick-disconnect

电缆颜色：
┌──────────────────────────┐
│ 白色(CAN_H) │ 信号高    │
│ 蓝色(CAN_L) │ 信号低    │
│ 黑色(V-)    │ 电源负    │
│ 红色(V+)    │ 电源24V   │
│ 裸线(屏蔽)  │ 屏蔽/地   │
└──────────────────────────┘
```

### 4.4 DeviceNet配置

```
RSNetWorx配置步骤：

1. 创建网络
   File → New → DeviceNet
   
2. 上线扫描
   Network → Online
   
3. 发现设备
   Network → Browse
   
4. 配置设备
   双击设备图标
   设置参数
   
5. 映射I/O
   配置扫描表
   
6. 下载配置
   Network → Download
```

---

## 五、CC-Link总线

### 5.1 CC-Link概述

CC-Link（Control & Communication Link）是三菱电机开发的开放式现场总线，在亚洲特别是日本应用广泛。

**CC-Link家族**：

| 类型 | 传输速率 | 最大站数 | 特点 |
|:-----|:---------|:---------|:-----|
| CC-Link | 10Mbps | 64站 | 传统版本 |
| CC-Link/LT | 2.5Mbps | 64站 | 低成本 |
| CC-Link IE | 1Gbps | 254站 | 工业以太网 |
| CC-Link IE Field | 1Gbps | 254站 | 运动控制 |

### 5.2 CC-Link技术规格

```
CC-Link通信规格：
┌──────────────────────────────────────────┐
│ 物理层      │ RS485                      │
│ 拓扑结构    │ 总线型                     │
│ 传输速率    │ 156K/625K/2.5M/5M/10Mbps  │
│ 最大站数    │ 64站（占用1-4站）          │
│ 最大距离    │ 1200m@156K，100m@10M      │
│ 数据刷新    │ 链接扫描时间（可配置）     │
│ 电缆类型    │ 专用CC-Link电缆            │
└──────────────────────────────────────────┘
```

### 5.3 站类型

```
CC-Link站类型：

┌────────────────────────────────────────────┐
│ 站类型      │ 功能                        │
├─────────────┼────────────────────────────┤
│ 主站        │ 控制网络通信，管理从站      │
│ (Master)    │ 如：QJ61BT11N              │
├─────────────┼────────────────────────────┤
│ 本地站      │ 可与主站进行瞬时传输        │
│ (Local)     │ 智能设备                    │
├─────────────┼────────────────────────────┤
│ 远程I/O站   │ 简单I/O设备                │
│ (Remote I/O)│ 只能响应主站                │
├─────────────┼────────────────────────────┤
│ 远程设备站  │ 带参数设置的智能设备        │
│ (Remote Dev)│ 如：变频器、伺服            │
└────────────────────────────────────────────┘
```

### 5.4 数据映射

```
CC-Link数据区域：

远程输入(RX)：从站→主站
远程输出(RY)：主站→从站
远程寄存器(RWr)：从站→主站
远程寄存器(RWw)：主站→从站

站点数据分配（1站占用）：
┌─────────────────────────────────────┐
│ RX：32点    │ X(n*20)～X(n*20+1F)  │
│ RY：32点    │ Y(n*20)～Y(n*20+1F)  │
│ RWr：4字    │ Wr(n*4)～Wr(n*4+3)   │
│ RWw：4字    │ Ww(n*4)～Ww(n*4+3)   │
└─────────────────────────────────────┘
n = 站号-1
```

### 5.5 三菱CC-Link配置

**GX Works2配置**：

```
1. 添加CC-Link主站模块
   导航 → 参数 → 网络参数 → CC-Link
   
2. 设置网络参数
   - 站类型：主站
   - 模式：远程网络
   - 站数设置：按实际配置
   
3. 配置从站
   - 站号：1-64
   - 占用站数：1/2/3/4站
   - 刷新参数
   
4. 自动刷新设置
   设置数据与PLC设备的对应关系
   
5. 编写程序
   使用RX/RY/RWr/RWw数据
```

---

## 六、AS-Interface总线

### 6.1 AS-i概述

AS-Interface（Actuator Sensor Interface）是用于连接传感器和执行器的设备级总线，简单易用。

**AS-i特点**：
- 专为传感器/执行器设计
- 两线制（数据+电源）
- 扁平黄色电缆，穿刺连接
- 最大31/62个从站
- 最大距离100m（可扩展）
- 循环时间5ms

### 6.2 AS-i网络结构

```
AS-i系统组成：

    ┌─────────────┐
    │   PLC/CPU   │
    └──────┬──────┘
           │
    ┌──────┴──────┐
    │  AS-i主站   │
    │  模块      │
    └──────┬──────┘
           │
    ┌──────┴──────┐
    │  AS-i电源   │
    │  30V DC     │
    └──────┬──────┘
           │
    ════╤══╧══╤══════╤═══════
        │     │      │
      ┌─┴─┐ ┌─┴─┐  ┌─┴─┐
      │从站│ │从站│  │从站│
      │#1 │ │#2 │  │#3 │
      └───┘ └───┘  └───┘
      
    黄色扁平电缆（数据+电源）
```

### 6.3 AS-i寻址

```
AS-i从站地址分配：

传统AS-i（AS-i 2.0）：
- 地址范围：1-31
- 每站4位输入+4位输出

扩展AS-i（AS-i 3.0）：
- 地址范围：1A-31A，1B-31B
- 支持62个从站
- A/B地址独立

地址分配方式：
1. 手持编程器
2. 主站软件
3. 设备自动寻址
```

---

## 七、IO-Link

### 7.1 IO-Link概述

IO-Link是传感器/执行器的点对点通信标准，被称为"传感器的USB"。

**IO-Link特点**：
- 点对点连接（非总线）
- 使用标准3/4/5芯电缆
- 传输速率：4.8K/38.4K/230.4Kbps
- 双向通信
- 支持诊断和参数设置

### 7.2 IO-Link系统架构

```
IO-Link系统结构：

    ┌─────────────┐
    │     PLC     │
    └──────┬──────┘
           │
    ┌──────┴──────┐
    │  IO-Link    │
    │   主站      │
    │ (4/8端口)   │
    └──┬──┬──┬──┬─┘
       │  │  │  │
    ┌──┴┐┌┴─┐┌┴─┐┌┴──┐
    │传感││传感││执行││执行│
    │器1 ││器2 ││器1 ││器2 │
    └───┘└──┘└──┘└───┘
    
    每端口连接一个设备
    标准传感器电缆（M12）
```

### 7.3 IO-Link数据类型

| 数据类型 | 说明 | 应用 |
|:---------|:-----|:-----|
| 过程数据 | 周期性交换 | 测量值、开关状态 |
| 服务数据 | 按需访问 | 参数设置、诊断 |
| 事件数据 | 异步传输 | 报警、状态变化 |

---

## 八、现场总线选择

### 8.1 选型考虑因素

```
现场总线选型决策矩阵：
┌────────────────────────────────────────────────────┐
│ 因素          │ 考虑内容                          │
├───────────────┼────────────────────────────────────┤
│ 应用场景      │ 离散制造/过程控制/运动控制        │
│ PLC品牌       │ 西门子/三菱/AB/欧姆龙            │
│ 通信速度      │ 数据量大小/刷新周期要求           │
│ 传输距离      │ 设备分布范围                      │
│ 节点数量      │ 设备数量/扩展需求                 │
│ 设备兼容性    │ 现有设备支持的总线                │
│ 成本预算      │ 模块/电缆/工程成本                │
│ 技术支持      │ 本地技术服务能力                  │
│ 行业标准      │ 特定行业的习惯选择                │
└────────────────────────────────────────────────────┘
```

### 8.2 品牌与总线对应

| PLC品牌 | 推荐总线 | 备选方案 |
|:--------|:---------|:---------|
| 西门子 | PROFIBUS/PROFINET | Modbus、AS-i |
| 三菱 | CC-Link/CC-Link IE | DeviceNet、Modbus |
| 罗克韦尔 | DeviceNet/EtherNet/IP | ControlNet |
| 欧姆龙 | CompoNet/EtherCAT | DeviceNet |
| 施耐德 | Modbus/CANopen | PROFIBUS |
| 倍福 | EtherCAT | CANopen |

### 8.3 应用场景对应

```
典型应用的总线选择：

汽车制造：
├── 装配线：PROFINET、EtherNet/IP
├── 焊接：DeviceNet、PROFIBUS
└── 涂装：PROFIBUS-PA、FF

食品饮料：
├── 包装：CC-Link、DeviceNet
├── 灌装：AS-i、IO-Link
└── 仓储：PROFIBUS、Modbus

半导体：
├── 设备控制：EtherCAT
├── 环境监控：Modbus
└── MES接口：OPC UA

石油化工：
├── 过程控制：PROFIBUS-PA、FF
├── 安全系统：PROFIsafe
└── 远程I/O：Modbus RTU
```

### 8.4 成本对比

```
相对成本比较（以PROFIBUS为基准100）：

┌─────────────────────────────────────────┐
│ 总线类型     │ 相对成本 │ 说明         │
├──────────────┼──────────┼──────────────┤
│ AS-i         │   60    │ 设备级，便宜 │
│ Modbus RTU   │   70    │ 简单通用     │
│ DeviceNet    │   90    │ 中等成本     │
│ PROFIBUS-DP  │  100    │ 基准         │
│ CC-Link      │   95    │ 与PB相当     │
│ CANopen      │   85    │ 较经济       │
│ PROFINET     │  110    │ 以太网       │
│ EtherNet/IP  │  110    │ 以太网       │
│ EtherCAT     │  105    │ 高性能       │
└─────────────────────────────────────────┘
```

---

## 九、实践练习

### 练习1：PROFIBUS网络设计

设计一个PROFIBUS-DP网络，包含：
- 1台S7-300 CPU（主站）
- 3台ET200分布式I/O
- 2台变频器

**要求**：
1. 绘制网络拓扑图
2. 分配站地址
3. 选择传输速率
4. 计算最大电缆长度

### 练习2：总线选型

某汽车零部件生产线需要连接：
- 10台伺服驱动器
- 5个机器人控制器
- 20个分布式I/O站
- 要求刷新周期<5ms

请选择合适的现场总线并说明理由。

### 练习3：CC-Link配置

使用GX Works配置CC-Link网络：
- 主站：Q系列PLC
- 从站1：远程I/O（16DI/16DO）
- 从站2：变频器

完成参数配置和数据映射。

---

## 本节小结

1. **现场总线**大幅简化了工业控制系统的布线
2. **PROFIBUS**是欧洲最流行的现场总线
3. **CAN/CANopen**在汽车和嵌入式领域广泛应用
4. **DeviceNet**主要应用于北美市场
5. **CC-Link**是亚洲特别是日本的主流选择
6. **AS-i和IO-Link**适合传感器/执行器层连接
7. 选择总线要综合考虑**PLC品牌、性能需求、成本**等因素

---

## 思考题

1. 现场总线相比传统4-20mA系统有哪些优势？
2. PROFIBUS-DP和PROFIBUS-PA有什么区别？
3. CANopen中PDO和SDO各有什么特点？
4. 如何根据应用需求选择合适的现场总线？
5. IO-Link与传统现场总线有何不同？

---

> **下一节预告**：6.5 PLC与HMI通信 - 学习人机界面的通信配置和画面设计
