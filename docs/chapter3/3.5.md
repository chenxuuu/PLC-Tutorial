# 3.5 比较指令

> 本节将介绍PLC的数据比较指令

## 学习目标

- 掌握各种比较指令的用法
- 理解比较指令的应用场景
- 能够使用比较指令进行条件判断

---

## 1. 比较指令概述

### 1.1 什么是比较指令

比较指令用于比较两个数据的大小关系，根据比较结果输出ON或OFF状态。

```
比较指令工作原理：

┌───────────────────────────────────────────────────┐
│      ┌───────┐     比较      ┌───────┐           │
│      │ 数据1 │  ───────────→ │ 结果  │           │
│      └───────┘     运算符    └───────┘           │
│                      ↑           │               │
│      ┌───────┐       │           ▼               │
│      │ 数据2 │ ──────┘       成立=ON            │
│      └───────┘               不成立=OFF          │
└───────────────────────────────────────────────────┘
```

### 1.2 比较运算符

| 运算符 | 名称 | 含义 | 示例 |
|--------|------|------|------|
| **==** | 等于 | 相等时成立 | D0 == 100 |
| **<>** | 不等于 | 不相等时成立 | D0 <> 0 |
| **>** | 大于 | 大于时成立 | D0 > 50 |
| **<** | 小于 | 小于时成立 | D0 < 100 |
| **>=** | 大于等于 | 大于或等于时成立 | D0 >= 0 |
| **<=** | 小于等于 | 小于或等于时成立 | D0 <= 255 |

### 1.3 各品牌比较指令对照

| 功能 | 西门子(S7) | 三菱(FX) | 欧姆龙 |
|------|-----------|----------|--------|
| 等于 | CMP_== | = | = |
| 不等于 | CMP_<> | <> | <> |
| 大于 | CMP_> | > | > |
| 小于 | CMP_< | < | < |
| 大于等于 | CMP_>= | >= | >= |
| 小于等于 | CMP_<= | <= | <= |

---

## 2. 西门子比较指令

### 2.1 比较触点形式

```
西门子比较指令（触点形式）：

【等于比较】
       ┌──────┐
    ───┤ ==   ├───
       │ INT  │
    ───┤MW10  │
       │100   │
       └──────┘
当MW10=100时，触点闭合

【大于比较】
       ┌──────┐
    ───┤ >    ├───
       │ INT  │
    ───┤MW10  │
       │50    │
       └──────┘
当MW10>50时，触点闭合

【范围组合】(50 < MW10 < 100)
       ┌──────┐    ┌──────┐
    ───┤ >    ├────┤ <    ├───
       │ INT  │    │ INT  │
       │MW10  │    │MW10  │
       │50    │    │100   │
       └──────┘    └──────┘
```

### 2.2 比较指令块形式

```
【梯形图】
              ┌──────────┐
   I0.0 ─────┤  CMP     │──── Q0.0
              │          │
   MW10 ─────┤IN1       │
     100 ────┤IN2       │
              └──────────┘

【SCL程序】
IF MW10 = 100 THEN
    Q0.0 := TRUE;
ELSE
    Q0.0 := FALSE;
END_IF;

// 或简写
Q0.0 := (MW10 = 100);
```

### 2.3 数据类型

```
西门子支持的比较数据类型：

┌────────────────────────────────────────────────────┐
│  数据类型    │  说明          │  范围             │
├────────────────────────────────────────────────────┤
│  SINT       │  短整数        │  -128~127         │
│  INT        │  整数          │  -32768~32767     │
│  DINT       │  双整数        │  ±21亿            │
│  REAL       │  实数（浮点）  │  ±3.4E38          │
│  BYTE       │  字节          │  0~255            │
│  WORD       │  字            │  0~65535          │
│  DWORD      │  双字          │  0~4294967295     │
│  TIME       │  时间          │  T#0ms~T#24d      │
└────────────────────────────────────────────────────┘
```

---

## 3. 三菱比较指令

### 3.1 触点比较指令

```
三菱触点比较指令：

【LD=】装载等于
       [D0 = K100]
    ──────┤├──────────( Y0 )───
当D0=100时，Y0输出

【AND>】串联大于
       X0    [D0 > K50]
    ───┤├────────┤├──────( Y0 )───
当X0=ON且D0>50时，Y0输出

【OR<】并联小于
       X0
    ───┤├────┬────────────( Y0 )───
             │
    [D0<K100]│
    ─────┤├──┘
```

### 3.2 指令形式

```
【CMP比较指令】
       X0           D0    K100   M0
    ───┤├───────[CMP D0 K100 M0]───

结果存储：
· D0 > K100 → M0 = ON
· D0 = K100 → M1 = ON
· D0 < K100 → M2 = ON

【ZCP区间比较指令】
       X0           K50   K100   D0    M10
    ───┤├───────[ZCP K50 K100 D0 M10]───

结果：
· D0 < K50  → M10 = ON（小于下限）
· K50≤D0≤K100 → M11 = ON（在区间内）
· D0 > K100 → M12 = ON（大于上限）
```

### 3.3 16位与32位比较

```
三菱比较指令位数：

┌────────────────────────────────────────────────────┐
│  16位比较              │  32位比较                 │
├────────────────────────────────────────────────────┤
│  LD=, AND=, OR=        │  LDD=, ANDD=, ORD=       │
│  LD>, AND>, OR>        │  LDD>, ANDD>, ORD>       │
│  LD<, AND<, OR<        │  LDD<, ANDD<, ORD<       │
│  LD>=, AND>=, OR>=     │  LDD>=, ANDD>=, ORD>=    │
│  LD<=, AND<=, OR<=     │  LDD<=, ANDD<=, ORD<=    │
│  LD<>, AND<>, OR<>     │  LDD<>, ANDD<>, ORD<>    │
├────────────────────────────────────────────────────┤
│  CMP                   │  DCMP                    │
│  ZCP                   │  DZCP                    │
└────────────────────────────────────────────────────┘
```

---

## 4. 各种比较指令详解

### 4.1 等于比较（==）

```
等于比较：当两个值相等时成立

应用场景：
· 检测特定值
· 状态判断
· 位置到达检测

示例：检测温度是否达到设定值
       [D0 == K250]
    ──────┤├──────────( Y0 )───   // 温度到达提示

西门子SCL：
IF Temperature = SetPoint THEN
    AtTarget := TRUE;
END_IF;
```

### 4.2 不等于比较（<>）

```
不等于比较：当两个值不相等时成立

应用场景：
· 检测异常值
· 变化检测
· 非正常状态判断

示例：检测是否有故障
       [D10 <> K0]
    ──────┤├──────────( Y10 )───  // 故障指示
                                   // D10≠0时表示有故障

西门子SCL：
IF ErrorCode <> 0 THEN
    Alarm := TRUE;
END_IF;
```

### 4.3 大于比较（>）

```
大于比较：当第一个值大于第二个值时成立

应用场景：
· 上限报警
· 超量检测
· 速度过快判断

示例：温度超高报警
       [D0 > K300]
    ──────┤├──────────( Y1 )───   // 超高温报警

三菱程序：
       SM400       D0    K300
    ───┤├───────[> D0 K300]────( Y1 )───
```

### 4.4 小于比较（<）

```
小于比较：当第一个值小于第二个值时成立

应用场景：
· 下限报警
· 不足检测
· 速度过慢判断

示例：液位过低报警
       [D1 < K100]
    ──────┤├──────────( Y2 )───   // 液位过低报警

三菱程序：
       SM400       D1    K100
    ───┤├───────[< D1 K100]────( Y2 )───
```

### 4.5 大于等于比较（>=）

```
大于等于比较：当第一个值≥第二个值时成立

应用场景：
· 达到条件判断
· 计数完成检测
· 位置到达判断

示例：计数达到目标
       [C0 >= K100]
    ──────┤├──────────( Y3 )───   // 计数完成

西门子SCL：
IF Counter >= TargetCount THEN
    BatchComplete := TRUE;
END_IF;
```

### 4.6 小于等于比较（<=）

```
小于等于比较：当第一个值≤第二个值时成立

应用场景：
· 范围内判断
· 安全限值检测
· 余量不足提示

示例：库存不足提示
       [D5 <= K10]
    ──────┤├──────────( Y4 )───   // 库存不足

三菱程序：
       SM400       D5    K10
    ───┤├───────[<= D5 K10]────( Y4 )───
```

---

## 5. 范围比较

### 5.1 范围比较原理

```
范围比较：判断数据是否在指定范围内

          下限        上限
           │           │
           ▼           ▼
   ────────┼───────────┼────────
        ┌─────────────┐
        │  有效范围   │
        └─────────────┘

判断公式：下限 ≤ 数据 ≤ 上限
```

### 5.2 组合比较实现

```
用两个比较指令组合：

【判断 50 ≤ D0 ≤ 100】

西门子梯形图：
       ┌──────┐    ┌──────┐
    ───┤ >=   ├────┤ <=   ├──────( Q0.0 )───
       │ INT  │    │ INT  │
       │MW10  │    │MW10  │
       │50    │    │100   │
       └──────┘    └──────┘

三菱梯形图：
       [D0>=K50]   [D0<=K100]
    ──────┤├──────────┤├────────( Y0 )───

SCL：
IF (D0 >= 50) AND (D0 <= 100) THEN
    InRange := TRUE;
END_IF;
```

### 5.3 三菱ZCP区间比较

```
【ZCP指令】
       X0
    ───┤├───────[ZCP K50 K100 D0 M0]───

功能：比较D0与区间[K50, K100]的关系

结果输出：
┌────────────────────────────────────────────────────┐
│  条件               │  M0  │  M1  │  M2           │
├────────────────────────────────────────────────────┤
│  D0 < 50（小于下限）│  ON  │  OFF │  OFF          │
│  50≤D0≤100（在区间）│  OFF │  ON  │  OFF          │
│  D0 > 100（大于上限）│  OFF │  OFF │  ON          │
└────────────────────────────────────────────────────┘

应用：温度区间判断
ZCP K200 K300 D0 M10
· M10=ON：温度过低
· M11=ON：温度正常
· M12=ON：温度过高
```

---

## 6. 比较指令应用实例

### 6.1 温度控制

```
需求：
· 温度<200℃：加热
· 200℃≤温度≤250℃：保温
· 温度>250℃：停止加热

三菱程序：
       SM400
    ───┤├───────[ZCP K200 K250 D0 M0]───

// M0=ON：温度<200（需要加热）
// M1=ON：200≤温度≤250（保温）
// M2=ON：温度>250（过热）

// 加热输出
       M0
    ───┤├───────( Y0 )───     // 加热器

// 保温输出
       M1
    ───┤├───────( Y1 )───     // 保温加热

// 过热报警
       M2
    ───┤├───────( Y2 )───     // 报警
```

### 6.2 速度分档

```
需求：根据设定值分3档速度

分档标准：
· 设定<30：低速
· 30≤设定<70：中速
· 设定≥70：高速

程序：
// 低速判断
       [D10 < K30]
    ──────┤├──────────( M10 )───

// 中速判断
       [D10>=K30]  [D10<K70]
    ──────┤├─────────┤├────────( M11 )───

// 高速判断
       [D10 >= K70]
    ──────┤├──────────( M12 )───

// 速度输出
       M10
    ───┤├───────[MOV K500 D100]───   // 低速500

       M11
    ───┤├───────[MOV K1000 D100]───  // 中速1000

       M12
    ───┤├───────[MOV K2000 D100]───  // 高速2000
```

### 6.3 计数比较控制

```
需求：
· 计数<50：显示正常
· 计数=50：提示即将完成
· 计数≥100：停止并报警

程序：
// 产品计数
       X0           K100
    ───┤├───────[OUT C0]───

// 即将完成提示（=50时）
       [C0 = K50]
    ──────┤├──────────( Y1 )───   // 提示灯

// 完成停止（≥100时）
       [C0 >= K100]
    ──────┤├──────────( Y0 )───   // 停止
               ────────( Y2 )───   // 完成指示
```

### 6.4 液位控制

```
需求：水箱液位自动控制
· 液位<20%：启动进水
· 液位>80%：启动排水
· 20%≤液位≤80%：保持

程序：
// 检测低液位
       [D0 < K200]                 // D0为液位值(0-1000)
    ──────┤├────┬─────────( M0 )── // 低液位标志
               │
       M0      │
    ───┤├──────┘

// 检测高液位
       [D0 > K800]
    ──────┤├────┬─────────( M1 )── // 高液位标志
               │
       M1      │
    ───┤├──────┘

// 进水阀
       M0           M1
    ───┤├─────────┤/├─────( Y0 )── // 低液位且非高液位时进水

// 排水阀
       M1
    ───┤├─────────────────( Y1 )── // 高液位时排水
```

### 6.5 故障代码判断

```
需求：根据故障代码显示不同故障

故障代码表：
· 0：无故障
· 1：过热
· 2：过流
· 3：欠压
· 4：通信故障

程序：
// 无故障
       [D100 = K0]
    ──────┤├──────────( Y10 )───  // 正常指示

// 过热故障
       [D100 = K1]
    ──────┤├──────────( Y11 )───  // 过热指示

// 过流故障
       [D100 = K2]
    ──────┤├──────────( Y12 )───  // 过流指示

// 欠压故障
       [D100 = K3]
    ──────┤├──────────( Y13 )───  // 欠压指示

// 通信故障
       [D100 = K4]
    ──────┤├──────────( Y14 )───  // 通信故障

// 有任何故障时总报警
       [D100 <> K0]
    ──────┤├──────────( Y20 )───  // 总报警
```

---

## 7. 比较指令使用注意事项

### 7.1 数据类型匹配

```
注意事项：比较的两个数据类型应一致

┌────────────────────────────────────────────────────┐
│  错误示例：                                        │
│  比较 D0（整数）与 浮点数                         │
│  → 可能产生意外结果                               │
│                                                    │
│  正确做法：                                        │
│  · 整数与整数比较                                 │
│  · 浮点数与浮点数比较                             │
│  · 必要时进行类型转换                             │
└────────────────────────────────────────────────────┘
```

### 7.2 有符号与无符号

```
有符号数与无符号数比较：

有符号数：D0 = -1 (0xFFFF)
无符号数：比较时被视为 65535

示例：
[D0 > K0]    // 有符号比较：-1 > 0 = FALSE
[D0U > K0U]  // 无符号比较：65535 > 0 = TRUE

建议：
· 明确数据的符号属性
· 西门子使用对应类型的比较
· 三菱默认有符号，必要时转换
```

### 7.3 浮点数比较

```
浮点数比较注意事项：

由于浮点数精度问题，不建议直接用==比较

错误示例：
IF RealValue = 3.14 THEN  // 可能永远不相等

正确做法：使用范围判断
IF ABS(RealValue - 3.14) < 0.001 THEN
    // 认为相等
END_IF;

或使用>=和<=组合：
IF (RealValue >= 3.139) AND (RealValue <= 3.141) THEN
    // 在可接受范围内
END_IF;
```

---

## 本节小结

```
比较指令要点：

┌────────────────────────────────────────────────────┐
│  基本比较运算符                                    │
│  · ==（等于）  <>（不等于）                       │
│  · >（大于）   <（小于）                          │
│  · >=（大于等于）  <=（小于等于）                 │
├────────────────────────────────────────────────────┤
│  触点形式比较                                      │
│  · 可直接作为触点使用                             │
│  · 串联、并联灵活组合                             │
│  · 适合简单条件判断                               │
├────────────────────────────────────────────────────┤
│  范围比较                                          │
│  · 组合使用>=和<=                                 │
│  · 三菱可用ZCP指令                                │
│  · 一次判断三种结果                               │
├────────────────────────────────────────────────────┤
│  注意事项                                          │
│  · 数据类型要匹配                                 │
│  · 有符号/无符号要明确                            │
│  · 浮点数比较用范围判断                           │
└────────────────────────────────────────────────────┘
```

---

## 练习题

1. 编写程序判断D0是否在50~100范围内。
2. 根据温度值（D10）控制风扇：>30℃开启，<25℃关闭。
3. 设计一个故障诊断程序，根据故障代码（1-5）点亮对应指示灯。
4. 说明为什么浮点数不宜直接用==比较。

---

[← 上一节：3.4 数据传送指令](./3.4.md) | [返回目录](/) | [下一章：第四章 高级指令应用 →](../chapter4/4.1.md)
