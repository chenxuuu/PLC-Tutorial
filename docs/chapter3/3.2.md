# 3.2 定时器指令

> 本节将介绍PLC定时器的类型和使用方法

## 学习目标

- 掌握定时器的工作原理
- 了解不同类型定时器的区别
- 能够正确使用定时器编程

---

## 1. 定时器基本概念

### 1.1 什么是定时器

定时器是PLC中用于实现延时控制的软元件。它通过累计时间来控制程序的执行时机。

```
定时器工作原理：

         启动信号
            │
            ▼
    ┌───────────────┐
    │   定时器      │
    │  ┌───────┐   │
    │  │ 当前值 │   │──→ 定时器线圈
    │  │  CV   │   │    （达到设定值时接通）
    │  └───────┘   │
    │      ↑       │
    │  每个周期+1  │
    │      ↑       │
    │  ┌───────┐   │
    │  │ 设定值 │   │
    │  │  PT   │   │
    │  └───────┘   │
    └───────────────┘
```

### 1.2 定时器组成要素

| 要素 | 说明 | 示例 |
|------|------|------|
| **定时器编号** | 定时器的标识 | T0, T1, T37 |
| **设定值(PT)** | 预设的定时时间 | 100（=10秒@100ms） |
| **当前值(CV)** | 已经计时的时间 | 0~设定值 |
| **定时器线圈** | 计时到达时接通 | T0线圈 |
| **定时器触点** | 线圈的常开/常闭触点 | T0触点 |
| **时基** | 时间单位 | 1ms, 10ms, 100ms |

---

## 2. 定时器类型

### 2.1 定时器分类

```
PLC定时器类型：

┌─────────────────────────────────────────────────────┐
│                    定时器                           │
├────────────┬────────────┬────────────┬──────────────┤
│   TON      │    TOF     │    TP      │   TONR       │
│ 接通延时   │  断开延时  │  脉冲型    │  保持型      │
├────────────┼────────────┼────────────┼──────────────┤
│ 输入ON后   │ 输入OFF后  │ 输入ON时   │ 可累计      │
│ 延时接通   │ 延时断开   │ 输出脉冲   │ 断电保持    │
└────────────┴────────────┴────────────┴──────────────┘
```

### 2.2 各品牌定时器对照

| 功能 | 西门子(S7) | 三菱(FX) | 欧姆龙 |
|------|-----------|----------|--------|
| 接通延时 | TON | OUT T | TIM |
| 断开延时 | TOF | - | - |
| 脉冲型 | TP | - | - |
| 保持型 | TONR | ST | TMHH |

---

## 3. 接通延时定时器（TON）

### 3.1 工作原理

TON：输入信号**接通后**开始计时，计时到达设定值后输出接通。

```
TON时序图：

输入(IN)：  ____┌────────────────────┐____
                │                    │
                │←──── PT ────→│    
计时(CV)：  ____/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\____│____
                                    │
输出(Q)：   ________________┌────────┘____
                           │
                           ↑
                     计时到达后接通

特点：
· 输入ON后开始计时
· 达到设定值后输出接通
· 输入OFF后，计时值清零，输出断开
```

### 3.2 通用梯形图表示

```
【梯形图】
               ┌──────────┐
    输入 ──────┤   TON    ├──── 输出
               │          │
          PT ──┤ 设定时间 │
               │          │
          ET ──┤ 当前时间 │
               └──────────┘

【说明】
· 输入(IN)：启动输入
· PT：设定时间（预设延时）
· 输出(Q)：定时器输出
· ET：已计时时间（当前值）

【简化表示】
       启动信号       设定值
    ───┤├───────[TON T0, 5秒]───

       T0
    ───┤├───────( 输出 )───
```

### 3.3 TON应用实例

```
应用：延时启动（按下按钮5秒后电机启动）

Network 1: 定时器
       启动按钮
    ───┤├───────[TON T0, 5秒]───

Network 2: 输出
       T0
    ───┤├───────( 电机 )───

说明：按下启动按钮5秒后，电机启动
```

---

## 4. 断开延时定时器（TOF）

### 4.1 工作原理

TOF：输入信号**断开后**开始计时，计时到达设定值后输出断开。

```
TOF时序图：

输入(IN)：  ____┌────────────────┐____________
                │                │
输出(Q)：   ____┌────────────────┴───────┐____
                │                        │
                │              ←── PT ──→│
计时(CV)：  ____│________________/¯¯¯¯¯¯¯\____
                                         │
                                         ↑
                                   计时到达后断开

特点：
· 输入ON时，输出立即接通
· 输入OFF后开始计时
· 计时到达后输出断开
· 常用于延时关闭设备
```

### 4.2 TOF梯形图表示

```
【梯形图】
               ┌──────────┐
    输入 ──────┤   TOF    ├──── 输出
               │          │
          PT ──┤ 设定时间 │
               │          │
          ET ──┤ 当前时间 │
               └──────────┘
```

### 4.3 TOF应用实例

```
应用：延时关灯（人离开后10秒自动关灯）

       人体感应器
    ───┤├───────[TOF T0, 10秒]───

       T0
    ───┤├───────( 灯 )───

工作流程：
1. 检测到人 → 感应器=1 → 灯立即亮
2. 人离开 → 感应器=0 → 开始计时
3. 10秒后 → 灯灭
4. 如果人回来 → 感应器=1 → 重新开始
```

---

## 5. 脉冲定时器（TP）

### 5.1 工作原理

TP：输入信号触发后，输出固定宽度的脉冲。

```
TP时序图：

输入(IN)：  ____┌─┐___________┌─┐_______
                │ │           │ │
                │ │           │ │
输出(Q)：   ____┌───────┐_____┌───────┐__
                │       │     │       │
                │← PT →│     │← PT →│
                
计时(CV)：  ____/¯¯¯¯¯¯¯\_____/¯¯¯¯¯¯¯\__

特点：
· 输入上升沿触发
· 输出固定宽度脉冲（=PT）
· 计时期间输入变化不影响输出
· 常用于产生固定脉冲信号
```

### 5.2 TP梯形图表示

```
【梯形图】
               ┌──────────┐
    输入 ──────┤   TP     ├──── 输出
               │          │
          PT ──┤ 脉冲宽度 │
               │          │
          ET ──┤ 当前时间 │
               └──────────┘

【应用场景】
· 单次按钮产生固定长度脉冲
· 触发信号整形
· 延时脉冲产生
```

---

## 6. 保持型定时器（TONR）

### 6.1 工作原理

TONR：计时值可累计，输入断开后不清零。

```
TONR时序图：

输入(IN)：  ____┌────┐___┌────┐___┌────┐___
                │    │   │    │   │    │
计时(CV)：  ____/¯¯¯¯│___/¯¯¯¯│___/¯¯¯¯\__
                     ↓       ↓       │
                  保持    继续累计    │
                                      │
输出(Q)：   __________________________┌───
                                     │
                                累计达到PT

特点：
· 输入ON时计时，OFF时保持
· 可分多次累计计时
· 需要复位指令清零
· 用于累计运行时间等场合
```

### 6.2 TONR梯形图表示

```
【梯形图】
               ┌──────────┐
    输入 ──────┤  TONR    ├──── 输出
               │          │
          PT ──┤ 设定时间 │
               │          │
          ET ──┤ 累计时间 │
               │          │
    复位 ──────┤  R       │
               └──────────┘

【应用】累计设备运行时间、间歇工作的总时间统计
```

---

## 7. 定时器应用实例

### 7.1 闪烁电路

```
需求：指示灯以1秒间隔闪烁

使用两个定时器实现：

Network 1：T0计时（灭的时间）
       M0                T1
    ───┤/├─────────┤/├─────[TON T0, 1秒]───

Network 2：T1计时（亮的时间）
       T0
    ───┤├─────────────────[TON T1, 1秒]───

Network 3：输出控制
       T0
    ───┤├─────────────────( M0 )───

Network 4：指示灯
       M0
    ───┤├─────────────────( 指示灯 )───

时序：T0计时1秒→灯亮→T1计时1秒→灯灭→循环
```

### 7.2 顺序延时启动

```
需求：电机M1启动5秒后M2启动，再5秒后M3启动

Network 1: M1启动（自锁）
       启动按钮
    ───┤├────┬──────────────( M1 )───
             │
       M1    │
    ───┤├────┘

Network 2: T0定时（M1启动后计时）
       M1
    ───┤├───────[TON T0, 5秒]───

Network 3: M2启动（自锁）
       T0
    ───┤├────┬──────────────( M2 )───
             │
       M2    │
    ───┤├────┘

Network 4: T1定时（M2启动后计时）
       M2
    ───┤├───────[TON T1, 5秒]───

Network 5: M3启动（自锁）
       T1
    ───┤├────┬──────────────( M3 )───
             │
       M3    │
    ───┤├────┘
```

### 7.3 星-三角启动

```
需求：
· 启动时先星形接法，5秒后切换到三角形
· 主接触器、星形接触器、三角形接触器

Network 1: 启动/停止（自锁）
       启动        停止
    ───┤├────┬───┤/├────────( 运行标志 )───
             │
       运行标志
    ───┤├────┘

Network 2: 星形定时
       运行标志
    ───┤├───────[TON T0, 5秒]───

Network 3: 主接触器
       运行标志
    ───┤├───────────────────( 主接触器 )───

Network 4: 星形接触器（5秒内）
       运行标志      T0
    ───┤├─────────┤/├───────( 星形接触器 )───

Network 5: 三角形接触器（5秒后）
       T0
    ───┤├───────────────────( 三角形接触器 )───
```

### 7.4 长延时实现

```
需求：延时1小时（超出单个定时器范围）

方法：定时器+计数器组合

       启动信号       T1
    ───┤├─────────┤/├─────[TON T0, 60秒]───

       T0
    ───┤P├─────────────────[CTU C0, 60]───

       C0
    ───┤├─────────────────( 输出 )───

计算：60秒 × 60次 = 3600秒 = 1小时
```

---

## 8. 定时器使用注意事项

### 8.1 常见错误

```
错误1：定时器编号重复使用

Network 1:  启动1 ──┤├──[TON T0, 5秒]
Network 5:  启动2 ──┤├──[TON T0, 3秒]  ← 重复！

正确做法：每个定时器只用一次


错误2：不考虑定时器类型

需要断电保持的计时 → 应使用TONR/累计型
误用普通定时器 → 断电后计时丢失


错误3：忽视定时器复位

累计型定时器使用后忘记复位
下次使用时从上次值继续，导致逻辑错误
```

### 8.2 最佳实践

```
定时器使用建议：

┌────────────────────────────────────────────────────┐
│  1. 合理规划定时器编号                             │
│     · 按功能分组分配                              │
│     · 建立定时器分配表                            │
├────────────────────────────────────────────────────┤
│  2. 使用符号名称                                   │
│     · Timer_MotorDelay 比 T0 更清晰              │
│     · 便于程序维护                                │
├────────────────────────────────────────────────────┤
│  3. 注意时基选择                                   │
│     · 根据精度要求选择时基                        │
│     · 高精度场合用1ms/10ms定时器                 │
├────────────────────────────────────────────────────┤
│  4. 考虑累计功能                                   │
│     · 需要断电保持时选累计型                      │
│     · 记得在适当时机复位                          │
└────────────────────────────────────────────────────┘
```

---

## 本节小结

```
定时器指令要点：

┌────────────────────────────────────────────────────┐
│  TON（接通延时）                                   │
│  · 输入ON后开始计时                               │
│  · 达到设定值后输出ON                             │
│  · 最常用的定时器类型                             │
├────────────────────────────────────────────────────┤
│  TOF（断开延时）                                   │
│  · 输入ON时输出立即ON                             │
│  · 输入OFF后延时断开                              │
│  · 用于延时关闭设备                               │
├────────────────────────────────────────────────────┤
│  TP（脉冲型）                                      │
│  · 触发后输出固定宽度脉冲                         │
│  · 用于产生定时脉冲                               │
├────────────────────────────────────────────────────┤
│  TONR（保持型）                                    │
│  · 计时值可累计                                   │
│  · 需要复位指令清零                               │
│  · 用于累计运行时间                               │
└────────────────────────────────────────────────────┘
```

---

## 练习题

1. 说明TON、TOF、TP三种定时器的区别。
2. 设计一个5.5秒延时的梯形图程序。
3. 设计一个闪烁电路，亮2秒灭1秒循环。
4. 如何实现超过定时器最大范围的长延时？

---

[← 上一节：3.1 位逻辑指令](./3.1.md) | [返回目录](/) | [下一节：3.3 计数器指令 →](./3.3.md)
