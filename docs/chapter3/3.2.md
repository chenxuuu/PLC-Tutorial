# 3.2 定时器指令

> 本节将介绍PLC定时器的类型和使用方法

## 学习目标

- 掌握定时器的工作原理
- 了解不同类型定时器的区别
- 能够正确使用定时器编程

---

## 1. 定时器基本概念

### 1.1 什么是定时器

定时器是PLC中用于实现延时控制的软元件。它通过累计时间来控制程序的执行时机。

```
定时器工作原理：

         启动信号
            │
            ▼
    ┌───────────────┐
    │   定时器      │
    │  ┌───────┐   │
    │  │ 当前值 │   │──→ 定时器线圈
    │  │  CV   │   │    （达到设定值时接通）
    │  └───────┘   │
    │      ↑       │
    │  每个周期+1  │
    │      ↑       │
    │  ┌───────┐   │
    │  │ 设定值 │   │
    │  │  PT   │   │
    │  └───────┘   │
    └───────────────┘
```

### 1.2 定时器组成要素

| 要素 | 说明 | 示例 |
|------|------|------|
| **定时器编号** | 定时器的标识 | T0, T1, T37 |
| **设定值(PT)** | 预设的定时时间 | 100（=10秒@100ms） |
| **当前值(CV)** | 已经计时的时间 | 0~设定值 |
| **定时器线圈** | 计时到达时接通 | T0线圈 |
| **定时器触点** | 线圈的常开/常闭触点 | T0触点 |
| **时基** | 时间单位 | 1ms, 10ms, 100ms |

---

## 2. 定时器类型

### 2.1 定时器分类

```
PLC定时器类型：

┌─────────────────────────────────────────────────────┐
│                    定时器                           │
├────────────┬────────────┬────────────┬──────────────┤
│   TON      │    TOF     │    TP      │   TONR       │
│ 接通延时   │  断开延时  │  脉冲型    │  保持型      │
├────────────┼────────────┼────────────┼──────────────┤
│ 输入ON后   │ 输入OFF后  │ 输入ON时   │ 可累计      │
│ 延时接通   │ 延时断开   │ 输出脉冲   │ 断电保持    │
└────────────┴────────────┴────────────┴──────────────┘
```

### 2.2 各品牌定时器对照

| 功能 | 西门子(S7) | 三菱(FX) | 欧姆龙 |
|------|-----------|----------|--------|
| 接通延时 | TON | OUT T | TIM |
| 断开延时 | TOF | - | - |
| 脉冲型 | TP | - | - |
| 保持型 | TONR | ST | TMHH |

---

## 3. 接通延时定时器（TON）

### 3.1 工作原理

TON：输入信号**接通后**开始计时，计时到达设定值后输出接通。

```
TON时序图：

输入(IN)：  ____┌────────────────────┐____
                │                    │
                │←──── PT ────→│    
计时(CV)：  ____/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\____│____
                                    │
输出(Q)：   ________________┌────────┘____
                           │
                           ↑
                     计时到达后接通

特点：
· 输入ON后开始计时
· 达到设定值后输出接通
· 输入OFF后，计时值清零，输出断开
```

### 3.2 西门子TON指令

```
【梯形图】
                 ┌──────────┐
       I0.0 ────┤   TON    ├──── Q0.0
                │          │
           PT ──┤ T#5S     │
                │          │
           ET ──┤          │
                └──────────┘

【SCL程序】
"Timer_1".TON(IN := I0.0,
              PT := T#5S,
              Q => Q0.0,
              ET => "ElapsedTime");

【说明】
· IN：启动输入
· PT：设定时间（如T#5S = 5秒）
· Q：定时器输出
· ET：已计时时间
```

### 3.3 三菱定时器指令

```
【梯形图】
       X0          K50
    ───┤├───────[OUT T0]───

       T0
    ───┤├───────( Y0 )───

【说明】
· X0接通后，T0开始计时
· K50 = 50 × 100ms = 5秒（100ms时基）
· 5秒后T0触点闭合，Y0输出

【定时器时基】
┌────────────────────────────────────┐
│  T0-T199   : 100ms（0.1秒）时基   │
│  T200-T245 : 10ms（0.01秒）时基   │
│  T246-T249 : 1ms（0.001秒）时基   │  ← FX系列
│  T250-T255 : 100ms 累计型         │
└────────────────────────────────────┘
```

### 3.4 TON应用实例

```
应用：延时启动（按下按钮5秒后电机启动）

西门子程序：
Network 1: 定时器
       I0.0
    ───┤├───────[TON T1, T#5S]───

Network 2: 输出
       T1
    ───┤├───────( Q0.0 )───  // 电机

三菱程序：
       X0          K50
    ───┤├───────[OUT T0]───

       T0
    ───┤├───────( Y0 )───
```

---

## 4. 断开延时定时器（TOF）

### 4.1 工作原理

TOF：输入信号**断开后**开始计时，计时到达设定值后输出断开。

```
TOF时序图：

输入(IN)：  ____┌────────────────┐____________
                │                │
输出(Q)：   ____┌────────────────┴───────┐____
                │                        │
                │              ←── PT ──→│
计时(CV)：  ____│________________/¯¯¯¯¯¯¯\____
                                         │
                                         ↑
                                   计时到达后断开

特点：
· 输入ON时，输出立即接通
· 输入OFF后开始计时
· 计时到达后输出断开
· 常用于延时关闭设备
```

### 4.2 西门子TOF指令

```
【梯形图】
                 ┌──────────┐
       I0.0 ────┤   TOF    ├──── Q0.0
                │          │
           PT ──┤ T#10S    │
                │          │
           ET ──┤          │
                └──────────┘

【SCL程序】
"Timer_2".TOF(IN := I0.0,
              PT := T#10S,
              Q => Q0.0,
              ET => "ElapsedTime");
```

### 4.3 TOF应用实例

```
应用：延时关灯（人离开后10秒自动关灯）

       I0.0                          // 人体感应器
    ───┤├───────[TOF T1, T#10S]───

       T1
    ───┤├───────( Q0.0 )───         // 灯

工作流程：
1. 检测到人 → I0.0=1 → 灯立即亮
2. 人离开 → I0.0=0 → 开始计时
3. 10秒后 → 灯灭
4. 如果人回来 → I0.0=1 → 重新开始
```

---

## 5. 脉冲定时器（TP）

### 5.1 工作原理

TP：输入信号触发后，输出固定宽度的脉冲。

```
TP时序图：

输入(IN)：  ____┌─┐___________┌─┐_______
                │ │           │ │
                │ │           │ │
输出(Q)：   ____┌───────┐_____┌───────┐__
                │       │     │       │
                │← PT →│     │← PT →│
                
计时(CV)：  ____/¯¯¯¯¯¯¯\_____/¯¯¯¯¯¯¯\__

特点：
· 输入上升沿触发
· 输出固定宽度脉冲（=PT）
· 计时期间输入变化不影响输出
· 常用于产生固定脉冲信号
```

### 5.2 西门子TP指令

```
【梯形图】
                 ┌──────────┐
       I0.0 ────┤   TP     ├──── Q0.0
                │          │
           PT ──┤ T#2S     │
                │          │
           ET ──┤          │
                └──────────┘

【应用场景】
· 单次按钮产生固定长度脉冲
· 触发信号整形
· 延时脉冲产生
```

---

## 6. 保持型定时器（TONR）

### 6.1 工作原理

TONR：计时值可累计，输入断开后不清零。

```
TONR时序图：

输入(IN)：  ____┌────┐___┌────┐___┌────┐___
                │    │   │    │   │    │
计时(CV)：  ____/¯¯¯¯│___/¯¯¯¯│___/¯¯¯¯\__
                     ↓       ↓       │
                  保持    继续累计    │
                                      │
输出(Q)：   __________________________┌───
                                     │
                                累计达到PT

特点：
· 输入ON时计时，OFF时保持
· 可分多次累计计时
· 需要复位指令清零
· 用于累计运行时间等场合
```

### 6.2 西门子TONR指令

```
【梯形图】
                 ┌──────────┐
       I0.0 ────┤  TONR    ├──── Q0.0
                │          │
           PT ──┤ T#1H     │    // 1小时
                │          │
           ET ──┤          │
                │          │
       I0.1 ────┤  R       │    // 复位
                └──────────┘

【应用】累计设备运行时间
```

### 6.3 三菱累计型定时器

```
三菱FX系列：T250-T255为累计型定时器

       X0           K6000
    ───┤├───────[OUT T250]───    // 600秒累计

       X1
    ───┤├───────[RST T250]───    // 复位

       T250
    ───┤├───────( Y0 )───
```

---

## 7. 定时器精度与范围

### 7.1 西门子S7-1200/1500时间格式

```
时间格式：T#xDxHxMxSxMS

示例：
· T#5S      → 5秒
· T#1M30S   → 1分30秒
· T#2H      → 2小时
· T#1D12H   → 1天12小时
· T#500MS   → 500毫秒

范围：T#0MS 到 T#24D20H31M23S647MS
```

### 7.2 三菱定时器范围

```
三菱FX系列定时器设定值：

┌─────────────┬──────────────┬──────────────────┐
│  定时器号   │    时基      │   最大设定值     │
├─────────────┼──────────────┼──────────────────┤
│  T0-T199    │   100ms      │ 3276.7秒(约54分) │
│  T200-T245  │   10ms       │ 327.67秒(约5分)  │
│  T246-T249  │   1ms        │ 32.767秒         │
│  T250-T255  │   100ms累计  │ 3276.7秒         │
└─────────────┴──────────────┴──────────────────┘

设定值计算：实际时间 = K值 × 时基
例：K100 × 100ms = 10秒
```

### 7.3 定时器选择原则

```
选择合适的定时器：

┌────────────────────────────────────────────────────┐
│  需求              │  推荐定时器                   │
├────────────────────┼──────────────────────────────┤
│  启动延时          │  TON                         │
│  停止延时          │  TOF                         │
│  固定脉冲输出      │  TP                          │
│  累计运行时间      │  TONR / 累计型定时器         │
│  高精度定时        │  使用高速定时器/中断         │
└────────────────────────────────────────────────────┘
```

---

## 8. 定时器应用实例

### 8.1 闪烁电路

```
需求：指示灯以1秒间隔闪烁

方法1：使用两个定时器

Network 1：
       M0.0           T1          K10
    ───┤/├─────────┤/├─────[OUT T0]───

Network 2：
       T0                         K10
    ───┤├─────────────────[OUT T1]───

Network 3：
       T0
    ───┤├─────────────────( M0.0 )───

Network 4：
       M0.0
    ───┤├─────────────────( Y0 )───

时序：T0计时1秒→T1计时1秒→T0计时...
```

```
方法2：西门子使用时钟存储器

       M0.0.5                    // 1Hz时钟（0.5秒周期）
    ───┤├───────( Q0.0 )───

需在CPU属性中启用时钟存储器
```

### 8.2 顺序延时启动

```
需求：电机M1启动5秒后M2启动，再5秒后M3启动

Network 1: M1启动
       I0.0
    ───┤├────┬──────────────( Q0.0 )───  // M1
             │
       Q0.0  │
    ───┤├────┘

Network 2: T1定时
       Q0.0         K50
    ───┤├───────[OUT T0]───

Network 3: M2启动
       T0
    ───┤├────┬──────────────( Q0.1 )───  // M2
             │
       Q0.1  │
    ───┤├────┘

Network 4: T2定时
       Q0.1         K50
    ───┤├───────[OUT T1]───

Network 5: M3启动
       T1
    ───┤├────┬──────────────( Q0.2 )───  // M3
             │
       Q0.2  │
    ───┤├────┘
```

### 8.3 星-三角启动

```
需求：
· 启动时先星形接法，5秒后切换到三角形
· Q0.0：主接触器  Q0.1：星形  Q0.2：三角形

Network 1: 启动/停止
       I0.0        I0.1
    ───┤├────┬───┤/├────────( M0.0 )───  // 运行标志
             │
       M0.0  │
    ───┤├────┘

Network 2: 星形定时
       M0.0         K50
    ───┤├───────[OUT T0]───    // 5秒定时

Network 3: 主接触器
       M0.0
    ───┤├───────────────────( Q0.0 )───

Network 4: 星形接触器
       M0.0         T0
    ───┤├─────────┤/├───────( Q0.1 )───

Network 5: 三角形接触器
       T0
    ───┤├───────────────────( Q0.2 )───
```

### 8.4 长延时实现

```
需求：延时1小时（超出单个定时器范围）

方法：定时器级联

       I0.0         T10          K600
    ───┤├─────────┤/├─────[OUT T0]───   // 60秒

       T0                        K60
    ───┤├─────────────────[OUT T10]───  // 计数60次

       T10
    ───┤├─────────────────( Y0 )───     // 1小时后输出

计算：60秒 × 60次 = 3600秒 = 1小时
```

---

## 9. 定时器使用注意事项

### 9.1 常见错误

```
错误1：定时器编号重复使用

Network 1:  I0.0 ──┤├──[OUT T0 K50]
Network 5:  I0.1 ──┤├──[OUT T0 K30]  ← 重复！

正确做法：每个定时器只用一次


错误2：设定值计算错误

需要5秒延时：
错误：OUT T0 K5    （实际只有0.5秒）
正确：OUT T0 K50   （100ms×50=5秒）


错误3：忽略定时器类型

需要断电保持的计时 → 应使用TONR/累计型
误用普通定时器 → 断电后计时丢失
```

### 9.2 最佳实践

```
定时器使用建议：

┌────────────────────────────────────────────────────┐
│  1. 合理规划定时器编号                             │
│     · 按功能分组分配                              │
│     · 建立定时器分配表                            │
├────────────────────────────────────────────────────┤
│  2. 使用符号名称                                   │
│     · Timer_MotorDelay 比 T0 更清晰              │
│     · 便于程序维护                                │
├────────────────────────────────────────────────────┤
│  3. 注意时基选择                                   │
│     · 根据精度要求选择时基                        │
│     · 高精度场合用1ms/10ms定时器                 │
├────────────────────────────────────────────────────┤
│  4. 考虑累计功能                                   │
│     · 需要断电保持时选累计型                      │
│     · 记得在适当时机复位                          │
└────────────────────────────────────────────────────┘
```

---

## 本节小结

```
定时器指令要点：

┌────────────────────────────────────────────────────┐
│  TON（接通延时）                                   │
│  · 输入ON后开始计时                               │
│  · 达到设定值后输出ON                             │
│  · 最常用的定时器类型                             │
├────────────────────────────────────────────────────┤
│  TOF（断开延时）                                   │
│  · 输入ON时输出立即ON                             │
│  · 输入OFF后延时断开                              │
│  · 用于延时关闭设备                               │
├────────────────────────────────────────────────────┤
│  TP（脉冲型）                                      │
│  · 触发后输出固定宽度脉冲                         │
│  · 用于产生定时脉冲                               │
├────────────────────────────────────────────────────┤
│  TONR（保持型）                                    │
│  · 计时值可累计                                   │
│  · 需要复位指令清零                               │
│  · 用于累计运行时间                               │
└────────────────────────────────────────────────────┘
```

---

## 练习题

1. 说明TON、TOF、TP三种定时器的区别。
2. 三菱FX系列，设定5.5秒延时应如何编程？
3. 设计一个闪烁电路，亮2秒灭1秒循环。
4. 如何实现超过定时器最大范围的长延时？

---

[← 上一节：3.1 位逻辑指令](./3.1.md) | [返回目录](/) | [下一节：3.3 计数器指令 →](./3.3.md)
